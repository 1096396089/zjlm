import{d as j,r as W,b as q,q as G,p as I,s as O,c as V,g as Y,v as K,o as Q}from"./index-Bsc5dIt9.js";import{S as J,P as X,W as Z,b as F,c as ee,D as te,g as ae,B as ne,V as R,l as k,C as L,L as D,i as E,e as H,f as S}from"./textureCache-C8KgvDjd.js";const re={class:"w-screen h-screen flex flex-col"},ce=j({__name:"dan_three",setup(ie){const y=W(null);let v,f,p,B=0,d=null;const s=e=>{const t="https://steppy-dev.oss-cn-guangzhou.aliyuncs.com",r=e.replace(/^\/+/,"");return`${t}/${r}`},z=K(),P=e=>{if(typeof e=="string")return e;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="string")return e[0]},M=(e,t)=>{const r=P(z.params[e]),m=P(z.query[e]);return r||m||t},x=W(M("a","AC.png")),A=W(M("b","BC.png")),N=(e,t)=>{if(!t)return"";if(t.startsWith("http")||t.startsWith("/")||t.startsWith("./"))return t;const r=t.toLowerCase().endsWith(".png")?t:`${t}.png`;return s(`tietu/${e}/${r}`)},C=(e,t)=>{if(!d||!t)return;const r=N(e,t),m=a=>{a.colorSpace=F,a.wrapS=L,a.wrapT=L,a.minFilter=D,a.magFilter=E,a.flipY=!1,d.traverse(i=>{if(i instanceof H&&i.name.trim()===e){if(Array.isArray(i.material))i.material=i.material.map(n=>{if(n instanceof S){const c=n.clone();return c.map=a,c.needsUpdate=!0,c}return n});else if(i.material instanceof S){const n=i.material.clone();n.map=a,n.needsUpdate=!0,i.material=n}}})},h=Array.from(new Set([r,s(r.replace(/^\//,"")),"/"+r.replace(/^\//,""),r.replace(/^\//,""),"./"+r.replace(/^\//,"")]));k(h).then(a=>{h[0],m(a)}).catch(()=>{})},b=(e,t)=>{if(!d)return;const r=a=>{a.colorSpace=F,a.wrapS=L,a.wrapT=L,a.minFilter=D,a.magFilter=E,a.flipY=!1;const i=e.map(n=>n.trim().toLowerCase()).filter(Boolean);d.traverse(n=>{if(n instanceof H){const w=(n.name||"").trim().toLowerCase(),l=[];let u=n.parent;for(;u&&u!==d&&l.length<4;)u.name&&l.push(String(u.name).toLowerCase()),u=u.parent;if(i.some(o=>w.includes(o)||l.some(g=>g.includes(o))))if(n.material instanceof S){const o=n.material.clone();o.map=a,o.needsUpdate=!0,n.material=o}else Array.isArray(n.material)&&(n.material=n.material.map(o=>{if(o instanceof S){const g=o.clone();return g.map=a,g.needsUpdate=!0,g}return o}))}})},m=t.replace(/^\//,""),h=Array.from(new Set([t,s(m),"/"+m,m,"./"+m]));k(h).then(a=>{h[0],r(a)}).catch(()=>{})},U=()=>{C("A",x.value),C("B",A.value),[{path:s("tietu/xiedai.png"),keywords:["xiedai"]},{path:s("tietu/xiedi.png"),keywords:["xiedi","logoai"]},{path:s("tietu/xian.png"),keywords:["xian"]},{path:s("tietu/xian2.png"),keywords:["xian2"]},{path:s("tietu/xiedian.png"),keywords:["xiedian"]}].forEach(({keywords:t,path:r})=>b(t,r)),b(["xiedai"],s("tietu/xiedai.png")),b(["xian"],s("tietu/xian.png")),b(["xiedian"],s("tietu/xiedian.png"))},$=()=>{if(!y.value)return;v=new J;const e=y.value;f=new X(50,e.clientWidth/e.clientHeight,.1,1e3),f.position.set(0,0,5),p=new Z({antialias:!0,alpha:!0,preserveDrawingBuffer:!0});const t=e.clientWidth||window.innerWidth,r=e.clientHeight||Math.max(1,Math.round(window.innerHeight*.45));p.setSize(t,r),p.setPixelRatio(Math.min(window.devicePixelRatio,2)),p.outputColorSpace=F,p.setClearColor(0,0),e.appendChild(p.domElement);const m=new ee(16777215,3);v.add(m);const h=new te(16777215,3);h.position.set(5,5,5),v.add(h),ae(s("xie.gltf")).then(({scene:c})=>{d=c,d.scale.set(11,11,11),v.add(d);try{const w=new ne().setFromObject(d),l=w.getCenter(new R),u=w.getSize(new R),_=Math.max(u.x,u.y,u.z),o=f.fov*Math.PI/180,g=_/2/Math.tan(o/2);f.position.set(l.x,l.y,l.z+g*1.4),f.lookAt(l),f.updateProjectionMatrix()}catch(w){console.warn("无法自动框选模型:",w)}U(),console.log("模型已加载，已应用默认贴图 A:",x.value,"B:",A.value)}).catch(c=>{console.error("模型加载失败 xie.gltf:",c)});const a=()=>{if(!y.value)return;const c=y.value,w=c.clientWidth||window.innerWidth,l=c.clientHeight||Math.max(1,Math.round(window.innerHeight*.45));f.aspect=w/l,f.updateProjectionMatrix(),p.setSize(w,l)};window.addEventListener("resize",a);let i=null;"ResizeObserver"in window&&(i=new ResizeObserver(()=>{a()}),i.observe(e));const n=()=>{B=requestAnimationFrame(n),p.render(v,f)};n(),T=()=>{window.removeEventListener("resize",a),B&&cancelAnimationFrame(B),p&&p.dispose(),i&&i.disconnect()}};let T=()=>{};return q(async()=>{await G(),$()}),I(()=>z.fullPath,()=>{const e=M("a",x.value),t=M("b",A.value);x.value=e,A.value=t,d&&(C("A",x.value),C("B",A.value))}),O(()=>{T()}),(e,t)=>(Q(),V("div",re,[Y("div",{ref_key:"containerRef",ref:y,class:"w-full h-[45%]"},null,512)]))}});export{ce as default};
