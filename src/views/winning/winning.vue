<template>
  <div class="w-screen h-screen bg-[#F4EFE7] flex flex-col">
    <!-- 顶部标题 -->
    <div class="pt-6 flex justify-center px-32">
      <div class="relative inline-block">
        <Title></Title>
        <div class="absolute top-0 -translate-y-1 translate-x-[9rem] ">
          <Logo />
        </div>
      </div>
    </div>

    <!-- 奖品卡片区域 -->
    <div class=" mt-5 mb-6 flex items-center justify-center px-12">
      <img :src="cards[model.prizeLevel - 1]" alt="" class="max-w-full max-h-full object-contain"
        style="width: 100%; height: auto;">
    </div>


    <div class=" pt-5 flex justify-center ">
      <svg v-if="model.prizeLevel != 3" width="151" height="auto" viewBox="0 0 121 31" fill="none"
        xmlns="http://www.w3.org/2000/svg" @click="openDialog" @keydown.enter.prevent="openDialog"
        @keydown.space.prevent="openDialog">
        <path
          d="M38.3252 11.8526C37.9317 14.2351 37.2711 16.5123 36.2521 18.0233C36.1469 17.7173 36.0128 17.4219 35.8516 17.1413C36.7476 15.8235 37.2922 13.8205 37.6084 11.6874L38.3252 11.8526ZM40.0294 11.3149V12.095H36.1081V11.3149H40.0294ZM37.5698 15.2015V21.6358H36.867V15.2015H37.5698ZM39.6359 15.2015V20.6378H37.1763V19.8787H38.9542V16.0132H37.1763V15.2472L39.6359 15.2015ZM41.3928 13.8416V17.2572C41.3928 18.814 41.2065 20.8627 39.9873 22.2297C39.8095 22.0411 39.6046 21.88 39.3794 21.7518C40.5354 20.4762 40.6759 18.6769 40.6759 17.2537V13.8416H41.3928ZM42.6612 10.7984C42.1147 12.4701 41.2161 14.0051 40.0259 15.2999C39.883 15.0744 39.7195 14.8626 39.5375 14.6674C40.6471 13.5169 41.4757 12.1254 41.9585 10.6016L42.6612 10.7984ZM45.9009 18.3853V19.1373H41.1152V18.3853H45.9009ZM45.8798 16.0906V16.7934H41.1749V16.0906H45.8798ZM45.8798 13.8662V14.6076H41.1784V13.8662H45.8798ZM44.6254 11.7015V12.4043H41.586L41.9374 11.7015H44.6254ZM43.7294 14.2703V21.801H43.0266V14.2703H43.7294ZM44.5938 11.7015L44.7203 11.6663L45.2298 12.0177C44.8085 12.8491 44.2869 13.6257 43.6767 14.33C43.512 14.189 43.3357 14.062 43.1496 13.9505C43.6658 13.3076 44.0936 12.5985 44.4216 11.842V11.6804L44.5938 11.7015ZM46.2839 13.8662V21.1684C46.2839 21.6252 46.1961 21.8712 45.9114 21.9907C45.6268 22.1102 45.1209 22.1313 44.383 22.1313C44.3452 21.8681 44.2743 21.6107 44.1721 21.3652C44.7168 21.3863 45.1981 21.3863 45.3387 21.3652C45.4792 21.3441 45.5284 21.3125 45.5284 21.1579V13.8556L46.2839 13.8662Z"
          fill="black" />
        <path
          d="M51.4246 14.6142V15.4365H48.9053V14.6142H51.4246ZM50.5919 10.8858C51.1787 11.4305 51.9693 12.2036 52.3487 12.664L51.7971 13.2859C51.2438 12.632 50.6574 12.0068 50.0402 11.4129L50.5919 10.8858ZM50.2932 21.0415C50.481 20.9058 50.6357 20.7295 50.7458 20.5256C50.8559 20.3218 50.9186 20.0957 50.9292 19.8643V14.6142H51.6952V20.5319C51.6952 20.5319 50.743 21.3402 50.743 21.6705C50.6249 21.4398 50.4733 21.2278 50.2932 21.0415ZM50.6059 20.8728L50.8519 20.4863L53.2166 18.796C53.2776 19.0358 53.3563 19.2707 53.4521 19.4988C51.1962 21.1856 50.9011 21.4386 50.7394 21.6705L50.6059 20.8728ZM56.4879 10.6363C56.4633 15.1695 56.4177 19.8538 53.3466 22.2328C53.1767 22.0057 52.9701 21.8085 52.7353 21.6494C55.7149 19.4285 55.6728 14.9481 55.6903 10.6328L56.4879 10.6363ZM59.689 21.5932C59.4622 21.7663 59.2652 21.9752 59.1057 22.2117C56.4282 20.2965 55.9047 15.8863 55.6763 14.6072L56.379 14.5369C56.5442 15.6755 57.0853 19.8186 59.689 21.5932Z"
          fill="black" />
        <path
          d="M65.0968 10.8245C64.4855 12.5357 63.511 14.0942 62.2401 15.3928C62.0708 15.2057 61.8863 15.0329 61.6885 14.8762C62.9085 13.6844 63.8368 12.2268 64.4011 10.6172L65.0968 10.8245ZM66.0701 16.4013V17.1569H62.4404V16.4189L66.0701 16.4013ZM63.1818 18.8999C64.1004 19.7151 64.9425 20.6125 65.6977 21.5811L65.132 22.0907C64.3976 21.0962 63.5743 20.1705 62.6723 19.3251L63.1818 18.8999ZM64.2113 13.9485C64.652 14.3918 65.0442 14.8806 65.3814 15.4069L64.8403 15.811C64.5084 15.2659 64.1248 14.754 63.6948 14.2824L64.2113 13.9485ZM65.9401 16.4084L66.0701 16.3627L66.5691 16.7141C66.0023 18.0923 65.2959 19.4087 64.4608 20.6429C64.2856 20.4739 64.0937 20.3232 63.8881 20.193C64.6727 19.0791 65.327 17.8788 65.8382 16.6157V16.4189L65.9401 16.4084ZM64.6365 11.4465C65.5425 12.3554 66.3656 13.3432 67.0961 14.3983L66.6112 14.9992C65.8962 13.9108 65.0835 12.8899 64.1832 11.949L64.6365 11.4465ZM70.1285 14.7778C70.0863 19.4832 69.8509 21.3 66.8467 22.2839C66.7499 22.0597 66.6116 21.8558 66.4391 21.683C69.2711 20.808 69.4187 19.2232 69.4539 14.7778H70.1285ZM72.4054 11.3587V12.1177H67.2156V11.3587H72.4054ZM72.054 13.4952V19.4481H71.3126V14.1769H68.2486V19.4762H67.5459V13.5022L72.054 13.4952ZM70.2972 12.0123C70.0688 12.6764 69.8298 13.4179 69.5944 13.9169L68.976 13.7236C69.2145 13.0994 69.414 12.461 69.5733 11.812L70.2972 12.0123ZM70.2972 19.571C71.1198 20.2147 71.8926 20.9196 72.6092 21.6795L72.1173 22.2066C71.4048 21.4248 70.6368 20.6955 69.8193 20.0244L70.2972 19.571Z"
          fill="black" />
        <path
          d="M80.518 16.7891C80.135 19.6003 79.2003 21.4558 75.0822 22.2359C74.9962 21.9812 74.8666 21.7434 74.6992 21.5331C78.6065 20.8303 79.3655 19.2102 79.6888 16.7961L80.518 16.7891ZM77.7386 13.7529L77.9389 14.4346C76.9656 14.9934 75.922 15.5837 75.1068 16.0335L74.7555 15.2956C75.5074 14.9407 76.6318 14.3468 77.7386 13.7529ZM85.1772 17.7906V18.5566H74.9065V17.7906H85.1772ZM75.7112 11.3036C76.1796 11.9039 76.5649 12.5646 76.8567 13.268L76.2031 13.6615C75.9262 12.9393 75.554 12.2574 75.0963 11.6339L75.7112 11.3036ZM78.2727 10.6289V16.7996H77.5208V10.6289H78.2727ZM84.6291 11.7077L84.7767 11.6796L85.237 11.9326C84.2918 14.9828 81.934 16.2127 79.0352 16.7715C78.9297 16.5179 78.7877 16.2811 78.6135 16.0687C81.4245 15.6154 83.6523 14.519 84.4604 11.8518V11.7077H84.6291ZM81.9867 10.8538C81.3761 12.0702 80.4425 13.0951 79.2882 13.8161C79.148 13.594 78.9855 13.3868 78.8033 13.1977C79.85 12.5882 80.6925 11.682 81.2243 10.5938L81.9867 10.8538ZM85.4443 21.396C85.2442 21.6203 85.0816 21.8754 84.9629 22.1516C82.3768 21.7228 80.7077 20.6264 79.889 18.4828L80.5918 18.3036C81.3121 20.1309 82.953 21.0868 85.4443 21.3925V21.396ZM80.8342 13.1555C81.4752 13.6949 82.0539 14.3043 82.5595 14.9723L81.9481 15.3975C81.4578 14.7108 80.8868 14.0856 80.2474 13.535L80.8342 13.1555ZM84.6045 11.7112V12.4456H80.7675V11.7112H84.6045Z"
          fill="black" />
        <path
          d="M112.153 29.7742C83.0801 29.8761 53.3818 30.456 24.2633 30.0132C21.505 29.9816 13.7853 29.9253 11.0797 29.9183C9.97111 29.9582 8.86107 29.9136 7.75923 29.7848C6.09141 29.4919 4.54994 28.7049 3.33454 27.5258C2.11914 26.3466 1.28582 24.8296 0.942544 23.1713C0.671985 21.8957 0.794973 20.0578 0.763349 18.7541C0.763349 16.5648 0.745781 12.1547 0.742268 9.9689C0.680776 8.16934 1.19202 6.39668 2.20235 4.9063C3.21268 3.41592 4.66996 2.28476 6.36427 1.67568C7.25843 1.35893 8.19863 1.19152 9.14716 1.18019C20.8597 1.07945 32.5792 1.01035 44.3058 0.97287C65.9013 0.902588 88.688 0.856912 110.224 1.06776C111.707 1.06776 113.253 1.02558 114.686 1.49998C116.496 2.09969 118.057 3.28224 119.123 4.86281C120.19 6.44337 120.703 8.33288 120.582 10.236C120.582 11.6416 120.519 15.3911 120.512 16.8284C120.505 18.2656 120.477 19.7591 120.473 21.2245C120.507 22.7134 120.151 24.1852 119.44 25.4941C118.715 26.7905 117.658 27.8703 116.377 28.6225C115.096 29.3748 113.638 29.7723 112.153 29.7742ZM112.153 29.6688C113.613 29.6557 115.043 29.2535 116.295 28.5036C117.548 27.7537 118.578 26.6833 119.279 25.4027C119.962 24.1173 120.297 22.6759 120.252 21.221C120.252 19.7556 120.234 18.2902 120.217 16.8249L120.168 12.4288C120.136 11.1672 120.22 9.31178 119.964 8.09239C119.261 4.57832 115.983 1.85842 112.409 1.85139C90.1357 2.05521 66.6392 2.04815 44.3058 1.9603C32.5933 1.92985 20.8737 1.86075 9.14716 1.75298C7.7201 1.74712 6.31753 2.12378 5.08535 2.84376C3.85316 3.56373 2.83637 4.60073 2.14073 5.84689C1.45096 7.10805 1.10444 8.52823 1.13581 9.96538V14.3615C1.13581 15.8128 1.13581 19.5483 1.13581 20.9539C1.06698 22.031 1.2153 23.1109 1.57197 24.1295C1.92864 25.1481 2.48637 26.0847 3.21204 26.8835C3.93771 27.6823 4.81651 28.3272 5.79624 28.7797C6.77597 29.2322 7.83663 29.4832 8.91525 29.5177C12.8085 29.5458 20.3033 29.458 24.2914 29.4263C53.424 28.9801 83.0941 29.5704 112.181 29.6688H112.153Z"
          fill="black" />
      </svg>


      <svg v-else width="151" height="auto" viewBox="0 0 121 31" fill="none" xmlns="http://www.w3.org/2000/svg"
        @click="showDiaThree = true">
        <path
          d="M38.3252 11.8526C37.9317 14.2351 37.2711 16.5123 36.2521 18.0233C36.1469 17.7173 36.0128 17.4219 35.8516 17.1413C36.7476 15.8235 37.2922 13.8205 37.6084 11.6874L38.3252 11.8526ZM40.0294 11.3149V12.095H36.1081V11.3149H40.0294ZM37.5698 15.2015V21.6358H36.867V15.2015H37.5698ZM39.6359 15.2015V20.6378H37.1763V19.8787H38.9542V16.0132H37.1763V15.2472L39.6359 15.2015ZM41.3928 13.8416V17.2572C41.3928 18.814 41.2065 20.8627 39.9873 22.2297C39.8095 22.0411 39.6046 21.88 39.3794 21.7518C40.5354 20.4762 40.6759 18.6769 40.6759 17.2537V13.8416H41.3928ZM42.6612 10.7984C42.1147 12.4701 41.2161 14.0051 40.0259 15.2999C39.883 15.0744 39.7195 14.8626 39.5375 14.6674C40.6471 13.5169 41.4757 12.1254 41.9585 10.6016L42.6612 10.7984ZM45.9009 18.3853V19.1373H41.1152V18.3853H45.9009ZM45.8798 16.0906V16.7934H41.1749V16.0906H45.8798ZM45.8798 13.8662V14.6076H41.1784V13.8662H45.8798ZM44.6254 11.7015V12.4043H41.586L41.9374 11.7015H44.6254ZM43.7294 14.2703V21.801H43.0266V14.2703H43.7294ZM44.5938 11.7015L44.7203 11.6663L45.2298 12.0177C44.8085 12.8491 44.2869 13.6257 43.6767 14.33C43.512 14.189 43.3357 14.062 43.1496 13.9505C43.6658 13.3076 44.0936 12.5985 44.4216 11.842V11.6804L44.5938 11.7015ZM46.2839 13.8662V21.1684C46.2839 21.6252 46.1961 21.8712 45.9114 21.9907C45.6268 22.1102 45.1209 22.1313 44.383 22.1313C44.3452 21.8681 44.2743 21.6107 44.1721 21.3652C44.7168 21.3863 45.1981 21.3863 45.3387 21.3652C45.4792 21.3441 45.5284 21.3125 45.5284 21.1579V13.8556L46.2839 13.8662Z"
          fill="black" />
        <path
          d="M51.4246 14.6142V15.4365H48.9053V14.6142H51.4246ZM50.5919 10.8858C51.1787 11.4305 51.9693 12.2036 52.3487 12.664L51.7971 13.2859C51.2438 12.632 50.6574 12.0068 50.0402 11.4129L50.5919 10.8858ZM50.2932 21.0415C50.481 20.9058 50.6357 20.7295 50.7458 20.5256C50.8559 20.3218 50.9186 20.0957 50.9292 19.8643V14.6142H51.6952V20.5319C51.6952 20.5319 50.743 21.3402 50.743 21.6705C50.6249 21.4398 50.4733 21.2278 50.2932 21.0415ZM50.6059 20.8728L50.8519 20.4863L53.2166 18.796C53.2776 19.0358 53.3563 19.2707 53.4521 19.4988C51.1962 21.1856 50.9011 21.4386 50.7394 21.6705L50.6059 20.8728ZM56.4879 10.6363C56.4633 15.1695 56.4177 19.8538 53.3466 22.2328C53.1767 22.0057 52.9701 21.8085 52.7353 21.6494C55.7149 19.4285 55.6728 14.9481 55.6903 10.6328L56.4879 10.6363ZM59.689 21.5932C59.4622 21.7663 59.2652 21.9752 59.1057 22.2117C56.4282 20.2965 55.9047 15.8863 55.6763 14.6072L56.379 14.5369C56.5442 15.6755 57.0853 19.8186 59.689 21.5932Z"
          fill="black" />
        <path
          d="M65.0968 10.8245C64.4855 12.5357 63.511 14.0942 62.2401 15.3928C62.0708 15.2057 61.8863 15.0329 61.6885 14.8762C62.9085 13.6844 63.8368 12.2268 64.4011 10.6172L65.0968 10.8245ZM66.0701 16.4013V17.1569H62.4404V16.4189L66.0701 16.4013ZM63.1818 18.8999C64.1004 19.7151 64.9425 20.6125 65.6977 21.5811L65.132 22.0907C64.3976 21.0962 63.5743 20.1705 62.6723 19.3251L63.1818 18.8999ZM64.2113 13.9485C64.652 14.3918 65.0442 14.8806 65.3814 15.4069L64.8403 15.811C64.5084 15.2659 64.1248 14.754 63.6948 14.2824L64.2113 13.9485ZM65.9401 16.4084L66.0701 16.3627L66.5691 16.7141C66.0023 18.0923 65.2959 19.4087 64.4608 20.6429C64.2856 20.4739 64.0937 20.3232 63.8881 20.193C64.6727 19.0791 65.327 17.8788 65.8382 16.6157V16.4189L65.9401 16.4084ZM64.6365 11.4465C65.5425 12.3554 66.3656 13.3432 67.0961 14.3983L66.6112 14.9992C65.8962 13.9108 65.0835 12.8899 64.1832 11.949L64.6365 11.4465ZM70.1285 14.7778C70.0863 19.4832 69.8509 21.3 66.8467 22.2839C66.7499 22.0597 66.6116 21.8558 66.4391 21.683C69.2711 20.808 69.4187 19.2232 69.4539 14.7778H70.1285ZM72.4054 11.3587V12.1177H67.2156V11.3587H72.4054ZM72.054 13.4952V19.4481H71.3126V14.1769H68.2486V19.4762H67.5459V13.5022L72.054 13.4952ZM70.2972 12.0123C70.0688 12.6764 69.8298 13.4179 69.5944 13.9169L68.976 13.7236C69.2145 13.0994 69.414 12.461 69.5733 11.812L70.2972 12.0123ZM70.2972 19.571C71.1198 20.2147 71.8926 20.9196 72.6092 21.6795L72.1173 22.2066C71.4048 21.4248 70.6368 20.6955 69.8193 20.0244L70.2972 19.571Z"
          fill="black" />
        <path
          d="M80.518 16.7891C80.135 19.6003 79.2003 21.4558 75.0822 22.2359C74.9962 21.9812 74.8666 21.7434 74.6992 21.5331C78.6065 20.8303 79.3655 19.2102 79.6888 16.7961L80.518 16.7891ZM77.7386 13.7529L77.9389 14.4346C76.9656 14.9934 75.922 15.5837 75.1068 16.0335L74.7555 15.2956C75.5074 14.9407 76.6318 14.3468 77.7386 13.7529ZM85.1772 17.7906V18.5566H74.9065V17.7906H85.1772ZM75.7112 11.3036C76.1796 11.9039 76.5649 12.5646 76.8567 13.268L76.2031 13.6615C75.9262 12.9393 75.554 12.2574 75.0963 11.6339L75.7112 11.3036ZM78.2727 10.6289V16.7996H77.5208V10.6289H78.2727ZM84.6291 11.7077L84.7767 11.6796L85.237 11.9326C84.2918 14.9828 81.934 16.2127 79.0352 16.7715C78.9297 16.5179 78.7877 16.2811 78.6135 16.0687C81.4245 15.6154 83.6523 14.519 84.4604 11.8518V11.7077H84.6291ZM81.9867 10.8538C81.3761 12.0702 80.4425 13.0951 79.2882 13.8161C79.148 13.594 78.9855 13.3868 78.8033 13.1977C79.85 12.5882 80.6925 11.682 81.2243 10.5938L81.9867 10.8538ZM85.4443 21.396C85.2442 21.6203 85.0816 21.8754 84.9629 22.1516C82.3768 21.7228 80.7077 20.6264 79.889 18.4828L80.5918 18.3036C81.3121 20.1309 82.953 21.0868 85.4443 21.3925V21.396ZM80.8342 13.1555C81.4752 13.6949 82.0539 14.3043 82.5595 14.9723L81.9481 15.3975C81.4578 14.7108 80.8868 14.0856 80.2474 13.535L80.8342 13.1555ZM84.6045 11.7112V12.4456H80.7675V11.7112H84.6045Z"
          fill="black" />
        <path
          d="M112.153 29.7742C83.0801 29.8761 53.3818 30.456 24.2633 30.0132C21.505 29.9816 13.7853 29.9253 11.0797 29.9183C9.97111 29.9582 8.86107 29.9136 7.75923 29.7848C6.09141 29.4919 4.54994 28.7049 3.33454 27.5258C2.11914 26.3466 1.28582 24.8296 0.942544 23.1713C0.671985 21.8957 0.794973 20.0578 0.763349 18.7541C0.763349 16.5648 0.745781 12.1547 0.742268 9.9689C0.680776 8.16934 1.19202 6.39668 2.20235 4.9063C3.21268 3.41592 4.66996 2.28476 6.36427 1.67568C7.25843 1.35893 8.19863 1.19152 9.14716 1.18019C20.8597 1.07945 32.5792 1.01035 44.3058 0.97287C65.9013 0.902588 88.688 0.856912 110.224 1.06776C111.707 1.06776 113.253 1.02558 114.686 1.49998C116.496 2.09969 118.057 3.28224 119.123 4.86281C120.19 6.44337 120.703 8.33288 120.582 10.236C120.582 11.6416 120.519 15.3911 120.512 16.8284C120.505 18.2656 120.477 19.7591 120.473 21.2245C120.507 22.7134 120.151 24.1852 119.44 25.4941C118.715 26.7905 117.658 27.8703 116.377 28.6225C115.096 29.3748 113.638 29.7723 112.153 29.7742ZM112.153 29.6688C113.613 29.6557 115.043 29.2535 116.295 28.5036C117.548 27.7537 118.578 26.6833 119.279 25.4027C119.962 24.1173 120.297 22.6759 120.252 21.221C120.252 19.7556 120.234 18.2902 120.217 16.8249L120.168 12.4288C120.136 11.1672 120.22 9.31178 119.964 8.09239C119.261 4.57832 115.983 1.85842 112.409 1.85139C90.1357 2.05521 66.6392 2.04815 44.3058 1.9603C32.5933 1.92985 20.8737 1.86075 9.14716 1.75298C7.7201 1.74712 6.31753 2.12378 5.08535 2.84376C3.85316 3.56373 2.83637 4.60073 2.14073 5.84689C1.45096 7.10805 1.10444 8.52823 1.13581 9.96538V14.3615C1.13581 15.8128 1.13581 19.5483 1.13581 20.9539C1.06698 22.031 1.2153 23.1109 1.57197 24.1295C1.92864 25.1481 2.48637 26.0847 3.21204 26.8835C3.93771 27.6823 4.81651 28.3272 5.79624 28.7797C6.77597 29.2322 7.83663 29.4832 8.91525 29.5177C12.8085 29.5458 20.3033 29.458 24.2914 29.4263C53.424 28.9801 83.0941 29.5704 112.181 29.6688H112.153Z"
          fill="black" />
      </svg>

    </div>

    <!-- Dialog Modal -->
    <div v-show="showDialog" class="fixed inset-0 z-50 flex items-center justify-center" aria-modal="true" role="dialog"
      @click.self="closeDialog">
      <!-- Overlay -->
      <div class="absolute inset-0 bg-black/50"></div>
      <!-- Panel (Redesigned) -->
      <div class="relative z-10 w-[100%]">
        <div class="relative flex  justify-center items-center ">
          <!-- close button -->

          <!-- Step: QR code -->
          <div v-show="step === 'qrcode'"
            class=" rounded-2xl  w-[21rem]  h-[21rem]  py-16 flex flex-col  justify-center items-center bg-cover bg-center bg-no-repeat "
            :style="{ backgroundImage: `url(${fangxingBgUrl})` }">
            <img class="h-24 w-24 -translate-x-1 object-contain" src="./qr_code.jpg" alt="客服二维码" />
            <div
              class="my-2 flex flex-col items-center  -translate-x-1  justify-center text-[9px] leading-6 text-gray-800">
              <p>长按图片保存蹀愫管家二维码</p>
              <p>添加客服获取兑换奖品信息</p>
              <p>超过7天不领取视为自动放弃奖品</p>
            </div>
            <button type="button"
              class=" rounded-md -translate-x-1 bg-[#50744E] text-xs px-4 py-1 text-white shadow cursor-pointer"
              @click="toForm">
              已添加
            </button>
          </div>



          <!-- Step: Form -->
          <div v-show="step === 'form' && !showSecondConfirm"
            class=" rounded-2xl w-[332px] h-[367px] flex flex-col items-center bg-cover bg-center bg-no-repeat "
            :style="{ backgroundImage: `url(${changxingBgUrl})` }">
            <div class="text-center text-[12px] mt-12 font-semibold text-black">
              <p>请仔细填写收件信息</p>
              <p class="">填写错误视为自动放弃奖品</p>
            </div>

            <div class="mt-5 space-y-4">
              <div>
                <input v-model.trim="model.user_name" type="text" placeholder="请输入收件人"
                  class="w-full rounded-xl border border-black/70 bg-transparent px-5 py-1.5 text-xs placeholder:text-xs placeholder:text-gray-400 focus:outline-none" />
                <!-- <p v-if="errors.name" class="mt-1 text-left text-xs text-red-600">{{ errors.name }}</p> -->
              </div>
              <div>
                <input v-model.trim="model.mobile" type="tel" placeholder="请输入手机号码"
                  class="w-full rounded-xl border border-black/70 bg-transparent px-5 py-1.5 text-xs placeholder:text-xs placeholder:text-gray-400 focus:outline-none" />
                <!-- <p v-if="errors.phone" class="mt-1 text-left text-xs text-red-600">{{ errors.phone }}</p> -->
              </div>
              <div>
                <textarea v-model.trim="model.address" rows="3" placeholder="请输入收件地址"
                  class="w-full resize-none rounded-xl border border-black/70 bg-transparent px-5 py-1.5 text-xs placeholder:text-xs placeholder:text-gray-400 focus:outline-none"></textarea>
                <!-- <p v-if="errors.address" class="mt-1 text-left text-xs text-red-600">{{ errors.address }}</p> -->
              </div>
            </div>

            <!-- button bar outside the card bottom -->
            <div class=" flex justify-between  mt-4">
              <button type="button"
                class=" whitespace-nowrap mr-2 rounded-md bg-[#9C7D5E] text-xs px-2.5 py-2 text-white shadow"
                @click="confirmForm">是，确认无误</button>
              <button type="button"
                class=" whitespace-nowrap ml-2 rounded-md bg-[#50744E] text-xs px-[2.3rem] py-2 text-white shadow"
                @click="closeDialog">返回</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Second Confirm Dialog -->
    <div v-show="showSecondConfirm" class="fixed inset-0 z-[60] flex items-center justify-center" aria-modal="true"
      role="dialog" @click.self="cancelSecond">

      <svg width="320" height="315" viewBox="0 0 320 315" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M245.338 1.40699L4.9917 69.056C2.23486 69.8319 0.629032 72.6958 1.40498 75.4526L67.3033 309.58C68.0793 312.337 70.9432 313.942 73.7 313.166L314.047 245.518C316.804 244.742 318.409 241.878 317.634 239.121L251.735 4.9937C250.959 2.23686 248.095 0.631042 245.338 1.40699Z"
          fill="#AF80A8" />
        <path
          d="M262.177 14.2276L14.9452 49.1497C12.1094 49.5503 10.1353 52.1739 10.5358 55.0097L44.5543 295.843C44.9548 298.679 47.5784 300.653 50.4142 300.253L297.646 265.331C300.482 264.93 302.456 262.306 302.055 259.471L268.037 18.637C267.636 15.8012 265.012 13.827 262.177 14.2276Z"
          fill="#9C7D5E" />
        <path
          d="M274.455 30.4922C275.772 30.4917 277.076 30.7503 278.293 31.2539C279.51 31.7575 280.615 32.4968 281.546 33.4277C282.477 34.3587 283.217 35.4641 283.721 36.6807C284.225 37.8971 284.484 39.2009 284.484 40.5176V274.055C284.484 276.714 283.428 279.264 281.548 281.145C279.668 283.025 277.118 284.081 274.459 284.081H34.4561C31.7973 284.081 29.2473 283.025 27.3672 281.145C25.487 279.264 24.4307 276.714 24.4307 274.055V40.5176C24.4307 37.8587 25.4871 35.3088 27.3672 33.4287C29.2473 31.5486 31.7972 30.4922 34.4561 30.4922H274.455Z"
          fill="#E8D8C8" />
        <path
          d="M83.2833 137.507V138.517H80.9551V137.507H83.2833ZM82.3236 133.448C82.9843 134.078 83.5959 134.764 84.1521 135.5L83.5388 136.247C82.9948 135.476 82.3927 134.755 81.7387 134.089L82.3236 133.448ZM82.1845 144.806C82.3605 144.669 82.5036 144.489 82.6023 144.281C82.701 144.073 82.7524 143.844 82.7523 143.611V137.507H83.6041V144.488C83.6041 144.488 82.6359 145.292 82.6359 145.702C82.525 145.382 82.3731 145.081 82.1845 144.806ZM82.494 144.712L82.7381 144.269L84.879 142.418C84.9491 142.723 85.051 143.02 85.1828 143.301C83.1527 145.122 82.8375 145.426 82.6615 145.699L82.494 144.712ZM91.9999 137.661V138.463H84.6944V137.661H91.9999ZM91.6365 134.241V135.033H85.0522V134.232L91.6365 134.241ZM91.2674 135.928V136.69H85.3503V135.928H91.2674ZM90.4468 139.267V140.09H86.4008V145.945H85.5491V139.267H90.4468ZM90.4468 143.022V143.787H86.1879V143.022H90.4468ZM90.4241 141.14V141.883H86.2078V141.14H90.4241ZM88.7461 133.133V137.904H87.8517V133.133H88.7461ZM91.0459 139.267V144.779C91.0459 145.301 90.9494 145.577 90.6115 145.732C90.2737 145.887 89.7313 145.896 88.8795 145.89C88.8252 145.576 88.7356 145.27 88.6127 144.979C89.2259 145.013 89.8023 145.007 89.967 145.001C90.1317 144.995 90.1828 144.934 90.1828 144.761V139.267H91.0459Z"
          fill="black" />
        <path
          d="M104.059 141.611V142.585H92.96V141.611H104.059ZM103.613 133.992V134.97H93.3915V133.992H103.613ZM102.077 136.332V137.295H95.2768V145.981H94.3881V136.326L102.077 136.332ZM102.051 138.964V139.875H94.9815V138.964H102.051ZM98.9026 134.302V141.972H97.9997V134.296L98.9026 134.302ZM102.594 136.332V144.676C102.594 145.314 102.466 145.632 102.066 145.793C101.665 145.954 100.998 145.975 99.9588 145.975C99.8857 145.629 99.7752 145.293 99.6295 144.974C100.424 145.007 101.197 144.992 101.407 144.974C101.617 144.956 101.691 144.898 101.691 144.67V136.326L102.594 136.332Z"
          fill="black" />
        <path
          d="M108.919 141.085V142.117H105.114V141.085H108.919ZM108.547 135.318V136.335H105.373V135.33L108.547 135.318ZM112.147 137.121V138.226C112.147 140.533 111.812 143.774 108.115 145.99C107.928 145.68 107.7 145.4 107.44 145.158C110.923 143.122 111.199 140.217 111.199 138.205V137.121H112.147ZM110.975 133.354C110.54 135.746 109.822 138.023 108.922 139.507C108.643 139.277 108.345 139.074 108.033 138.9C108.953 137.543 109.62 135.364 109.989 133.133L110.975 133.354ZM115.012 135.531V136.563H109.453L109.853 135.531H115.012ZM116.102 144.94C115.86 145.21 115.655 145.517 115.495 145.851C113.087 144.709 111.889 142.16 111.295 138.648L112.071 138.493C112.601 141.635 113.814 144.017 116.108 144.952L116.102 144.94ZM114.876 135.531L115.052 135.47L115.716 135.889C115.408 137.194 114.985 138.466 114.453 139.686C114.26 139.565 113.902 139.358 113.686 139.246C114.156 138.138 114.51 136.979 114.742 135.789V135.543L114.876 135.531Z"
          fill="black" />
        <path
          d="M119.558 134.456C119.183 137.403 118.544 140.132 117.437 141.944C117.274 141.623 117.084 141.318 116.869 141.034C117.863 139.443 118.385 136.945 118.686 134.307L119.558 134.456ZM121.633 133.904V134.863H117.13V133.904H121.633ZM118.857 138.059V145.204H118.047V138.059H118.857ZM121.222 138.059V144.023H118.445V143.082H120.401V138.991H118.445V138.059H121.222ZM122.974 136.699V140.399C122.974 142.141 122.761 144.469 121.48 146.002C121.299 145.745 121.08 145.519 120.833 145.335C122.003 143.938 122.136 141.956 122.136 140.396V136.699H122.974ZM124.297 133.379C123.787 135.102 122.972 136.706 121.898 138.102C121.692 137.85 121.467 137.617 121.225 137.406C122.258 136.177 123.025 134.717 123.468 133.133L124.297 133.379ZM127.255 141.574V142.484H122.562V141.574H127.255ZM127.255 136.684V137.595H122.616V136.684H127.255ZM127.255 139.112V139.95H122.616V139.112H127.255ZM125.895 134.295V135.173H123.101L123.479 134.295H125.895ZM125.273 137.115V141.971H124.476V137.115H125.273ZM125.816 134.295L125.952 134.247L126.543 134.702C126.167 135.597 125.708 136.45 125.174 137.249C124.977 137.081 124.768 136.93 124.549 136.796C124.991 136.077 125.35 135.303 125.62 134.493V134.295H125.816ZM127.698 136.69V144.749C127.698 145.325 127.596 145.635 127.258 145.79C126.92 145.945 126.35 145.978 125.518 145.978C125.463 145.634 125.368 145.298 125.234 144.979C125.844 145.01 126.438 145.01 126.605 145.001C126.773 144.992 126.827 144.931 126.827 144.74V136.699L127.698 136.69Z"
          fill="black" />
        <path
          d="M131.756 137.508V138.518H129.146V137.508H131.756ZM130.884 133.413C131.486 134.02 132.304 134.87 132.718 135.386L132.085 136.145C131.517 135.415 130.916 134.716 130.282 134.05L130.884 133.413ZM130.501 144.643C130.698 144.488 130.859 144.287 130.974 144.056C131.088 143.825 131.153 143.569 131.162 143.308V137.508H132.04V144.055C132.04 144.055 131.001 144.986 131.001 145.393C130.87 145.118 130.701 144.865 130.501 144.643ZM130.839 144.434L131.1 143.994L133.525 142.109C133.596 142.408 133.691 142.701 133.809 142.983C131.503 144.85 131.185 145.144 131.012 145.411L130.839 144.434ZM136.972 133.164C136.943 138.148 136.895 143.305 133.738 145.973C133.546 145.688 133.311 145.439 133.042 145.238C136.089 142.771 136.035 137.881 136.054 133.164H136.972ZM140.217 145.184C139.958 145.399 139.735 145.659 139.555 145.952C136.804 143.797 136.284 138.934 136.057 137.489L136.861 137.404C137.023 138.667 137.551 143.183 140.22 145.168L140.217 145.184Z"
          fill="black" />
        <path
          d="M141.336 142.483C141.477 142.379 141.591 142.237 141.665 142.071C141.739 141.906 141.772 141.722 141.759 141.539V134.686H142.642V142.471C142.642 142.471 141.711 143.078 141.711 143.445C141.622 143.11 141.496 142.787 141.336 142.483ZM141.62 142.45L142.032 142.022L144.913 140.929C144.965 141.238 145.037 141.542 145.129 141.84C142.358 142.987 141.963 143.218 141.722 143.451L141.62 142.45ZM145.396 133.344V145.965H144.499V133.341L145.396 133.344ZM148.471 133.314C148.051 136.024 147.31 138.501 146.174 140.134C145.985 139.823 145.769 139.531 145.53 139.263C146.563 137.842 147.202 135.572 147.545 133.141L148.471 133.314ZM151.256 136.489C150.589 141.154 149.218 144.146 146.319 145.971C146.151 145.664 145.955 145.377 145.734 145.112C148.536 143.533 149.797 140.692 150.362 136.349L151.256 136.489ZM152.208 145.048C151.961 145.297 151.748 145.582 151.574 145.895C149.093 144.313 147.616 140.95 146.81 136.92L147.551 136.728C148.284 140.425 149.791 143.664 152.205 145.045L152.208 145.048ZM152.103 135.854V136.844H147.21V135.842L152.103 135.854Z"
          fill="black" />
        <path
          d="M156.705 133.488C155.949 135.846 154.782 138.205 153.53 139.78C153.386 139.419 153.212 139.073 153.011 138.745C154.146 137.388 155.206 135.297 155.85 133.188L156.705 133.488ZM155.487 135.789H155.501V145.908H154.635V136.778L155.487 135.789ZM158.692 134.037C158.363 135.983 157.812 137.889 157.116 139.134C156.874 138.936 156.616 138.762 156.344 138.615C157.045 137.455 157.551 135.652 157.821 133.837L158.692 134.037ZM164.087 140.084V141.11H156.421V140.09L164.087 140.084ZM163.559 135.989V137.015H157.71L157.937 135.989H163.559ZM160.799 133.306V145.948H159.896V133.306H160.799Z"
          fill="black" />
        <path
          d="M168.548 133.468C167.846 135.809 166.736 138.158 165.549 139.736C165.407 139.392 165.237 139.062 165.041 138.75C166.126 137.387 167.131 135.296 167.738 133.192L168.548 133.468ZM167.511 135.869V145.977H166.679V136.81L167.511 135.869ZM176.055 135.444V136.328H168.389V135.444H176.055ZM175.234 141.46V145.91H174.419V142.325H169.876V145.952H169.09V141.46H175.234ZM175.109 137.445V138.307H169.257V137.445H175.109ZM175.109 139.421V140.273H169.257V139.421H175.109ZM174.72 144.538V145.403H169.632V144.538H174.72ZM171.955 133.141C172.297 133.719 172.591 134.328 172.832 134.962L172.02 135.381C171.787 134.728 171.502 134.099 171.168 133.499L171.955 133.141Z"
          fill="black" />
        <path
          d="M179.245 142.382C178.921 143.385 178.523 144.359 178.056 145.296L177.232 144.841C177.74 143.947 178.153 142.996 178.465 142.006L179.245 142.382ZM186.375 134.436V141.071H179.016V134.436H186.375ZM180.745 142.024V144.282C180.745 144.671 180.884 144.737 181.653 144.737H184.319C184.964 144.737 185.06 144.54 185.117 143.12C185.374 143.308 185.664 143.44 185.969 143.508C185.847 145.287 185.549 145.706 184.385 145.706H181.613C180.217 145.706 179.847 145.402 179.847 144.294V142.024H180.745ZM179.893 136.381H185.481V135.273H179.884L179.893 136.381ZM179.893 138.3H185.481V137.177H179.884L179.893 138.3ZM179.893 140.23H185.481V139.098H179.884L179.893 140.23ZM182.425 141.034C183.065 141.668 183.624 142.39 184.086 143.18L183.351 143.708C182.904 142.9 182.361 142.158 181.736 141.499L182.425 141.034ZM183.345 133.209C183.093 133.816 182.797 134.424 182.582 134.824L181.77 134.612C181.977 134.088 182.152 133.549 182.292 133L183.345 133.209ZM186.676 141.778C187.255 142.636 187.722 143.574 188.064 144.567L187.213 145.004C186.886 143.999 186.436 143.044 185.872 142.166L186.676 141.778Z"
          fill="black" />
        <path
          d="M192.4 140.815C192.014 143.134 191.148 144.864 189.828 145.975C189.624 145.709 189.393 145.466 189.141 145.253C190.415 144.294 191.185 142.724 191.5 140.682L192.4 140.815ZM200.066 139.298V140.232H189.425V139.298H200.066ZM198.74 133.719V138.326H190.685V133.719H198.74ZM196.702 144.691C197.162 144.691 199.677 144.691 200.299 144.691C200.144 145.007 200.034 145.345 199.973 145.696H196.668C193.843 145.696 192.213 145.113 191.273 142.299L192.025 141.975C192.747 144.251 194.337 144.685 196.702 144.688V144.691ZM191.56 135.637H197.826V134.508H191.56V135.637ZM191.56 137.531H197.826V136.39H191.56V137.531ZM195.291 139.698V144.98H194.382V139.698H195.291ZM199.266 141.771V142.697H194.76V141.771H199.266Z"
          fill="black" />
        <path
          d="M208.198 134.777C206.685 136.986 204.189 138.68 201.81 139.739C201.624 139.403 201.411 139.085 201.174 138.789C203.556 137.9 205.975 136.309 207.321 134.324L208.198 134.777ZM211.989 133.93V134.934H201.549V133.945L211.989 133.93ZM210.745 140.701V145.931H209.783V141.612H203.82V145.952H202.892V140.701H210.745ZM210.177 144.344V145.279H203.38V144.344H210.177ZM207.202 135.293V135.311V140.279H206.282V136.334L207.202 135.293ZM208.363 136.27C209.753 136.948 211.069 137.789 212.287 138.777L211.639 139.569C210.438 138.532 209.12 137.659 207.716 136.971L208.363 136.27Z"
          fill="black" />
        <path
          d="M214.141 133.747C214.781 134.723 215.344 135.753 215.825 136.828L214.973 137.338C214.517 136.239 213.975 135.183 213.352 134.181L214.141 133.747ZM215.2 140.121L216.001 140.634C215.495 142.191 214.834 143.973 214.271 145.309L213.357 144.814C214.053 143.284 214.668 141.713 215.2 140.109V140.121ZM218.968 133.508C218.272 135.848 217.187 138.097 215.975 139.557C215.775 139.29 215.555 139.041 215.316 138.813C216.509 137.496 217.525 135.417 218.13 133.271L218.968 133.508ZM224.007 135.632V136.543H218.017V145.952H217.165V136.449L217.832 135.629H224.01L224.007 135.632ZM223.76 138.416V139.326H217.758V138.416H223.76ZM224.249 144.019V144.966H217.767V144.019H224.249ZM223.752 141.193V142.103H217.772V141.193H223.752ZM220.856 133.234C221.232 133.851 221.554 134.505 221.816 135.186L220.998 135.663C220.755 134.955 220.452 134.274 220.092 133.626L220.856 133.234ZM221.424 136.145V144.538H220.546V136.145H221.424Z"
          fill="black" />
        <path
          d="M227.823 134.456C227.446 137.403 226.807 140.132 225.7 141.944C225.538 141.622 225.348 141.317 225.132 141.034C226.126 139.443 226.651 136.945 226.949 134.307L227.823 134.456ZM229.899 133.904V134.863H225.399V133.904H229.899ZM227.122 138.059V145.204H226.31V138.059H227.122ZM229.487 138.059V144.023H226.708V143.082H228.667V138.991H226.708V138.059H229.487ZM231.236 136.699V140.399C231.236 142.141 231.023 144.469 229.743 146.002C229.562 145.744 229.343 145.519 229.095 145.335C230.265 143.938 230.402 141.956 230.402 140.396V136.699H231.236ZM232.559 133.379C232.05 135.102 231.237 136.705 230.163 138.102C229.956 137.85 229.73 137.618 229.487 137.406C230.519 136.176 231.283 134.716 231.725 133.133L232.559 133.379ZM235.518 141.574V142.484H230.827V141.574H235.518ZM235.518 136.684V137.595H230.893V136.684H235.518ZM235.518 139.112V139.95H230.893V139.112H235.518ZM234.158 134.295V135.173H231.361L231.736 134.295H234.158ZM233.536 137.115V141.971H232.738V137.115H233.536ZM234.076 134.295L234.212 134.247L234.802 134.702C234.428 135.598 233.969 136.451 233.434 137.249C233.237 137.081 233.028 136.93 232.809 136.796C233.251 136.077 233.61 135.303 233.88 134.493V134.295H234.076ZM235.961 136.69V144.749C235.961 145.325 235.859 145.635 235.518 145.79C235.177 145.945 234.612 145.978 233.777 145.978C233.725 145.633 233.629 145.297 233.494 144.979C234.104 145.01 234.7 145.01 234.868 145.001C235.035 144.992 235.089 144.931 235.089 144.74V136.699L235.961 136.69Z"
          fill="black" />
        <path
          d="M145.987 227.625H52.9365C50.7414 227.625 48.9619 229.402 48.9619 231.595V256.655C48.9619 258.848 50.7414 260.625 52.9365 260.625H145.987C148.182 260.625 149.962 258.848 149.962 256.655V231.595C149.962 229.402 148.182 227.625 145.987 227.625Z"
          fill="#9C7D5E" @click="confirmSecond" />
        <path
          d="M66.317 245.37C65.9063 247.686 64.9922 249.393 63.5845 250.488C63.3677 250.22 63.1222 249.976 62.8525 249.76C64.2072 248.811 65.0253 247.249 65.3598 245.225L66.317 245.37ZM74.4549 243.848V244.778H63.1539V243.848H74.4549ZM73.0506 238.32V242.896H64.492V238.32H73.0506ZM70.8844 249.218C71.3713 249.218 74.0409 249.218 74.7033 249.218C74.5392 249.53 74.4221 249.864 74.3555 250.21H70.8613C67.8605 250.21 66.1282 249.635 65.1247 246.839L65.9229 246.508C66.688 248.781 68.3739 249.218 70.8844 249.218ZM65.4228 240.229H72.0801V239.111H65.4228V240.229ZM65.4228 242.108H72.0801V240.974H65.4228V242.108ZM69.3973 244.262V249.502H68.4301V244.255L69.3973 244.262ZM73.6302 246.316V247.233H68.8442V246.313L73.6302 246.316Z"
          fill="white" />
        <path
          d="M77.8174 246.031C78.864 245.561 79.4337 244.863 79.4337 243.817L79.1952 242.656L79.8875 243.702C79.8097 243.809 79.7068 243.895 79.5878 243.952C79.4688 244.01 79.3374 244.038 79.2052 244.032C79.0747 244.039 78.9443 244.018 78.8228 243.97C78.7013 243.922 78.5916 243.848 78.5012 243.754C78.4107 243.66 78.3415 243.547 78.2984 243.424C78.2553 243.301 78.2392 243.17 78.2513 243.04C78.2428 242.91 78.2619 242.779 78.3071 242.657C78.3524 242.534 78.4229 242.423 78.514 242.329C78.6052 242.236 78.715 242.162 78.8363 242.114C78.9576 242.065 79.0878 242.043 79.2184 242.048C79.9305 242.048 80.3114 242.673 80.3114 243.642C80.3233 244.331 80.1156 245.005 79.7185 245.569C79.3214 246.132 78.7554 246.554 78.1022 246.775L77.8174 246.031Z"
          fill="white" />
        <path
          d="M86.3099 239.053C85.9125 241.978 85.2335 244.677 84.0577 246.487C83.8824 246.166 83.6784 245.861 83.4482 245.577C84.5048 243.999 85.0579 241.518 85.3759 238.901L86.3099 239.053ZM88.5158 238.507V239.457H83.7331V238.507H88.5158ZM85.5647 242.629V249.722H84.7035V242.629H85.5647ZM88.0786 242.629V248.555H85.1275V247.622H87.2075V243.556H85.1275V242.633L88.0786 242.629ZM89.9367 241.28V244.942C89.9367 246.672 89.7115 248.985 88.3502 250.506C88.1579 250.251 87.9266 250.028 87.6646 249.845C88.9033 248.459 89.049 246.49 89.049 244.942V241.276L89.9367 241.28ZM91.341 237.971C90.7992 239.682 89.9346 241.273 88.794 242.659C88.5753 242.409 88.336 242.178 88.0786 241.968C89.1742 240.747 89.9853 239.298 90.4534 237.727L91.341 237.971ZM94.4843 246.12V247.033H89.5161V246.12H94.4843ZM94.4843 241.266V242.163H89.5724V241.276L94.4843 241.266ZM94.4843 243.672V244.505H89.5724V243.672H94.4843ZM93.0402 238.891V239.761H90.0725L90.47 238.891H93.0402ZM92.3777 241.687V246.517H91.5298V241.687H92.3777ZM92.9541 238.891L93.0965 238.841L93.7225 239.295C93.325 240.184 92.8378 241.031 92.2684 241.822C92.0601 241.655 91.8386 241.504 91.606 241.372C92.076 240.657 92.4585 239.889 92.7454 239.083V238.891H92.9541ZM94.9413 241.266V249.266C94.9413 249.841 94.832 250.146 94.471 250.301C94.11 250.457 93.5072 250.487 92.6228 250.487C92.5688 250.144 92.4697 249.81 92.3281 249.494C92.9905 249.521 93.6098 249.521 93.7887 249.514C93.9675 249.507 94.0239 249.444 94.0239 249.256V241.276L94.9413 241.266Z"
          fill="white" />
        <path
          d="M100.035 242.085V243.077H97.2461V242.085H100.035ZM99.1075 238.006C99.7468 238.605 100.628 239.452 101.055 239.964L100.393 240.719C99.9753 240.189 99.1108 239.29 98.4716 238.654L99.1075 238.006ZM98.7001 249.155C98.9097 249.001 99.082 248.803 99.2041 248.574C99.3263 248.345 99.3951 248.091 99.4056 247.831V242.088H100.34V248.589C100.34 248.589 99.2334 249.512 99.2334 249.912C99.0957 249.634 98.9158 249.378 98.7001 249.155ZM99.0578 248.946L99.336 248.51L101.913 246.641C101.985 246.937 102.082 247.227 102.201 247.507C99.7534 249.36 99.4155 249.654 99.2201 249.916L99.0578 248.946ZM105.573 237.758C105.543 242.72 105.49 247.825 102.138 250.475C101.936 250.192 101.686 249.945 101.4 249.747C104.635 247.296 104.576 242.442 104.599 237.758H105.573ZM109.021 249.691C108.746 249.905 108.508 250.162 108.315 250.452C105.394 248.315 104.841 243.504 104.599 242.055L105.454 241.969C105.639 243.236 106.186 247.722 109.021 249.691Z"
          fill="white" />
        <path
          d="M116.881 239.073C116.758 243.123 116.55 248.224 111.353 250.477C111.179 250.16 110.955 249.873 110.69 249.627C115.738 247.572 115.801 242.779 115.9 239.073H116.881ZM122.346 242.769V243.784H110.866V242.769H122.346ZM121.617 238.68V239.699H111.661V238.68H121.617ZM117.722 243.576V248.538C117.722 249.041 117.848 249.137 118.507 249.137H120.739C121.369 249.137 121.468 248.806 121.531 246.924C121.808 247.129 122.122 247.28 122.455 247.367C122.329 249.577 122.031 250.156 120.799 250.156H118.408C117.083 250.156 116.725 249.799 116.725 248.538V243.576H117.722Z"
          fill="white" />
        <path
          d="M126.595 242.065V243.058H124.303V242.065H126.595ZM125.684 238.125C126.4 238.752 127.058 239.442 127.651 240.186L126.989 240.944C126.407 240.167 125.76 239.443 125.055 238.777L125.684 238.125ZM125.654 249.108C125.809 248.988 125.933 248.832 126.015 248.653C126.097 248.475 126.135 248.279 126.124 248.083V242.065H127.055V249.013C127.055 249.013 126.161 249.674 126.161 250.061C126.029 249.725 125.859 249.405 125.654 249.108ZM126.008 249.108L126.293 248.675L128.453 247.137C128.519 247.432 128.607 247.721 128.714 248.003C126.664 249.548 126.343 249.813 126.161 250.065L126.008 249.108ZM132.61 243.954C132.437 247.385 131.871 249.419 128.589 250.478C128.46 250.17 128.277 249.888 128.049 249.644C131.116 248.748 131.546 246.998 131.692 243.954H132.61ZM136.024 245.837V246.766H128.406V245.837H136.024ZM135.534 243.382V244.318H128.847V243.382H135.534ZM135.167 238.396V242.141H129.205V238.396H135.167ZM130.096 241.225H134.229V239.296H130.096V241.225ZM136.097 249.634C135.842 249.89 135.633 250.188 135.478 250.514C133.623 249.893 132.368 248.53 131.735 246.601L132.563 246.379C132.828 247.179 133.292 247.898 133.913 248.467C134.534 249.037 135.29 249.439 136.11 249.634H136.097Z"
          fill="white" />
        <path
          d="M255.983 228.078H163.04C160.848 228.078 159.07 229.856 159.07 232.048V257.108C159.07 259.301 160.848 261.078 163.04 261.078H255.983C258.175 261.078 259.953 259.301 259.953 257.108V232.048C259.953 229.856 258.175 228.078 255.983 228.078Z"
          fill="#50744E" @click="cancelSecond" />
        <path
          d="M180.399 239.825C178.794 242.018 176.148 243.699 173.624 244.751C173.433 244.417 173.211 244.101 172.962 243.808C175.489 242.925 178.053 241.343 179.483 239.375L180.399 239.825ZM184.422 238.984V239.977H173.342V238.984H184.422ZM183.098 245.694V250.888H182.07V246.613H175.731V250.914H174.738V245.703L183.098 245.694ZM182.496 249.333V250.259H175.284V249.343L182.496 249.333ZM179.34 240.344V240.364V245.297H178.364V241.38L179.34 240.344ZM180.571 241.317C182.045 241.991 183.441 242.825 184.733 243.805L184.045 244.592C182.77 243.562 181.372 242.695 179.883 242.011L180.571 241.317Z"
          fill="white" />
        <path
          d="M187.889 246.476C188.934 246.006 189.5 245.308 189.5 244.263L189.262 243.102L189.953 244.147C189.876 244.254 189.774 244.34 189.656 244.398C189.537 244.456 189.406 244.483 189.275 244.478C189.145 244.485 189.014 244.463 188.893 244.415C188.772 244.367 188.662 244.294 188.572 244.199C188.481 244.105 188.412 243.993 188.369 243.87C188.326 243.746 188.31 243.615 188.322 243.485C188.313 243.355 188.332 243.224 188.377 243.102C188.422 242.979 188.492 242.867 188.583 242.773C188.674 242.68 188.784 242.606 188.906 242.558C189.027 242.51 189.157 242.488 189.288 242.493C189.999 242.493 190.38 243.118 190.38 244.088C190.391 244.776 190.184 245.451 189.787 246.014C189.39 246.577 188.825 246.999 188.173 247.22L187.889 246.476Z"
          fill="white" />
        <path
          d="M205.145 244.89V245.734H193.999V244.89H205.145ZM204.986 240.59V243.567H204.023V241.397H195.054V243.567H194.135V240.59H204.986ZM204.387 238.773V239.571H194.7V238.773H204.387ZM203.725 246.713V247.57H195.888V250.878H194.982V246.707L203.725 246.713ZM198.316 243.316L198.349 243.977C197.357 244.199 196.388 244.414 195.554 244.589L195.269 243.782C196.083 243.693 197.188 243.514 198.33 243.326L198.316 243.316ZM195.878 241.662C196.725 241.822 197.553 242.068 198.349 242.396L198.072 243.025C197.273 242.678 196.443 242.408 195.594 242.217L195.878 241.662ZM198.664 247.266V250.816H197.777V247.266H198.664ZM200.093 245.251C199.868 245.989 199.597 246.75 199.378 247.262L198.535 247.163C198.755 246.523 198.928 245.867 199.054 245.201L200.093 245.251ZM199.964 239.051V244.467H199.024V239.051H199.964ZM200.725 243.249C201.737 243.377 202.735 243.605 203.702 243.931L203.49 244.642C202.514 244.297 201.507 244.045 200.483 243.888L200.725 243.249ZM201.489 247.266V250.816H200.612V247.266H201.489ZM203.51 242.188C202.7 242.527 201.859 242.791 200.999 242.975L200.668 242.442C201.495 242.208 202.307 241.924 203.1 241.592L203.51 242.188ZM204.413 246.723V249.886C204.413 250.366 204.344 250.617 204.016 250.759C203.689 250.902 203.219 250.918 202.528 250.918C202.458 250.618 202.355 250.328 202.22 250.051C202.739 250.051 203.173 250.051 203.312 250.051C203.451 250.051 203.49 250.002 203.49 249.866V246.717L204.413 246.723Z"
          fill="white" />
        <path
          d="M216.756 245.577C215.608 249.156 212.869 250.49 207.728 250.926C207.649 250.605 207.521 250.298 207.348 250.016C212.284 249.686 214.798 248.505 215.83 245.292L216.756 245.577ZM218.784 246.106V246.989H207.387V246.106H218.784ZM218.573 238.805V239.721H207.583V238.805H218.573ZM218.037 240.899V244.482H208.224V240.899H218.037ZM211.46 244.64L212.416 244.879C211.773 246.203 210.997 247.459 210.1 248.627H208.989C209.967 247.4 210.797 246.062 211.46 244.64ZM209.743 247.949C212.746 248.429 215.702 249.171 218.576 250.165L217.693 250.91C215.754 250.109 212.489 249.256 208.992 248.634L209.743 247.949ZM209.124 243.648H217.091V241.769H209.124V243.648ZM211.979 239.159V243.992H211.069V239.159H211.979ZM214.957 239.159V243.992H214.05V239.159H214.957Z"
          fill="white" />
        <path
          d="M224.087 238.545C223.369 240.947 222.225 243.375 220.958 244.986C220.819 244.62 220.652 244.266 220.458 243.927C221.573 242.544 222.585 240.421 223.204 238.28L224.087 238.545ZM223.065 240.702L223.095 240.728V250.918H222.182V241.655L223.065 240.702ZM225.05 239.842V248.618H224.203V239.842H225.05ZM228.332 238.426C227.75 240.002 226.849 241.442 225.685 242.654C225.461 242.426 225.217 242.22 224.954 242.038C226.073 240.968 226.923 239.649 227.435 238.188L228.332 238.426ZM231.518 240.126C230.482 242.75 228.285 244.252 225.645 245.135C225.482 244.842 225.29 244.567 225.073 244.311C227.654 243.6 229.738 242.233 230.614 239.898L231.518 240.126ZM232.391 247.709C231.117 249.363 228.715 250.355 226.009 250.858C225.883 250.556 225.714 250.274 225.506 250.021C228.077 249.621 230.419 248.741 231.561 247.322L232.391 247.709ZM229.88 244.801C229.103 245.681 227.786 246.402 226.572 246.839C226.417 246.61 226.235 246.401 226.029 246.217C227.17 245.846 228.461 245.201 229.142 244.477L229.88 244.801ZM231.094 246.124C230.125 247.279 228.421 248.149 226.704 248.648C226.562 248.401 226.394 248.17 226.201 247.96C227.822 247.56 229.509 246.779 230.37 245.797L231.094 246.124ZM232.768 244.162C232.558 244.418 232.381 244.699 232.242 244.999C229.265 244.261 227.333 242.455 226.489 240.735L227.081 240.229C227.842 241.899 229.774 243.573 232.758 244.175L232.768 244.162ZM232.364 239.689V240.556H226.684L227.167 239.689H232.364Z"
          fill="white" />
        <path
          d="M234.502 249.175C234.694 249.083 234.902 248.904 234.902 248.395V243.125H235.868V249.41C235.868 249.41 234.876 249.877 234.876 250.261C234.801 249.884 234.675 249.518 234.502 249.175ZM239.263 239.165V244.147H235.121V243.125H238.306V240.187H234.73V239.165H239.263ZM234.763 249.225L235.21 248.778L239.249 247.214C239.266 247.547 239.305 247.878 239.368 248.206C235.65 249.754 235.177 250.003 234.882 250.271L234.763 249.225ZM245.108 241.461C244.42 246.248 242.951 249.195 239.646 250.972C239.494 250.636 239.3 250.321 239.071 250.032C242.207 248.501 243.543 245.732 244.119 241.325L245.108 241.461ZM242.316 238.381C241.823 240.948 240.993 243.383 239.911 244.974C239.682 244.708 239.434 244.458 239.17 244.226C240.229 242.79 240.953 240.531 241.373 238.195L242.316 238.381ZM246.111 249.983C245.852 250.241 245.629 250.534 245.449 250.853C242.687 249.321 241.267 246.013 240.52 241.811L241.367 241.636C242.015 245.473 243.454 248.679 246.111 249.983ZM245.906 240.756V241.732H240.927V240.762L245.906 240.756Z"
          fill="white" />
      </svg>


      


    </div>


    <div v-show="showDiaThree" class="fixed inset-0 z-50 flex items-center justify-center" aria-modal="true"
      role="dialog">
      <!-- Overlay -->
      <div class="absolute inset-0 bg-black/50" @click.self="showDiaThree = false"></div>
      <div class="relative z-[60] w-[100%]">
        <div class="relative flex  justify-center items-center ">

          <div
            class=" rounded-2xl  w-[21rem]  h-[21rem]  py-16 flex flex-col  justify-center items-center bg-cover bg-center bg-no-repeat "
            :style="{ backgroundImage: `url(${fangxing})` }">
            <img class="h-24 w-24 -translate-x-1 object-contain"
              src="https://steppy-dev.oss-cn-guangzhou.aliyuncs.com/qrcode.png" alt="客服二维码"/>
            <div
              class="my-2 flex flex-col items-center  -translate-x-1  justify-center text-[12px] leading-6 text-gray-800">
              <p>添加企微管家领取奖品</p>
              <p>或复制口令发送至电商渠道客服领取奖品</p>

            </div>

            <div
              class="my-2 flex flex-col items-center  -translate-x-1  justify-center text-[12px] leading-6 text-gray-800">
              <p>{{ model._id }}</p>
            </div>
            <button type="button"
              class=" rounded-md -translate-x-1 bg-[#50744E] text-xs px-4 py-1 text-white shadow cursor-pointer"
              @click.stop="copyToken">
              保存口令
            </button>
          </div>


        </div>
      </div>
    </div>


  </div>
</template>

<script setup lang="ts">
import { computed, onMounted, ref } from 'vue'
import { useRoute } from 'vue-router'
import Title from './title.vue'
import Logo from './logo.vue'
import { http } from '@/util/http'
import { useOpenIdStore } from '@/stores/openId';
import { ElMessage } from 'element-plus'

import fangxing from './fangxing.png'
import changxing from './changxing.png'

import one from './one.png'
import tow from './tow.png'
import te from './te.png'


// OSS bases
const NEW_OSS_BASE = 'https://tc-weshop.oss-cn-beijing.aliyuncs.com/lotter'
const OLD_OSS_BASE = 'https://steppy-dev.oss-cn-guangzhou.aliyuncs.com/lotter'

const makeOssCandidates = (relative: string): string[] => {
  const clean = relative.replace(/^\/+/, '')
  return [
    `${NEW_OSS_BASE}/${clean}`,
    `${OLD_OSS_BASE}/${clean}`,
  ]
}

const pickFirstReachable = async (urls: string[]): Promise<string> => {
  // Use Image probe to avoid CORS restrictions
  const probe = (u: string) => new Promise<boolean>((resolve) => {
    const img = new Image()
    img.crossOrigin = 'anonymous'
    img.onload = () => resolve(true)
    img.onerror = () => resolve(false)
    img.src = u
  })
  for (const u of urls) {
    if (await probe(u)) return u
  }
  return urls[0]
}

// dynamic URLs with fallback
const fangxingBgUrl = ref('')
const changxingBgUrl = ref('')
const qrcodeRemoteUrl = ref('')

const cards = ref<string[]>([])



const openIdStore = useOpenIdStore()

const route = useRoute()
const level = computed(() => {
  const v = (route.query.level as string) || '二等奖'
  try { return decodeURIComponent(v) } catch { return v }
})
const desc = computed(() => {
  const v = (route.query.desc as string) || '蹬愉小程序德训鞋优惠券99元'
  try { return decodeURIComponent(v) } catch { return v }
})

const showDialog = ref(false)
const step = ref<'qrcode' | 'form'>('form')
const form = ref({ name: '', phone: '', address: '' })
const errors = ref<{ name?: string; phone?: string; address?: string }>({})
const showSecondConfirm = ref(false)

const resetState = () => {
  step.value = 'form'
  form.value = { name: '', phone: '', address: '' }
  errors.value = {}
  showSecondConfirm.value = false
}

const openDialog = () => {
  resetState()
  showDialog.value = true
}
const closeDialog = () => {
  showDialog.value = false
  resetState()
}
const toForm = () => {
  showDialog.value = false
  showSecondConfirm.value = false
  resetState()
}

const validateForm = (): boolean => {
  const currentErrors: { name?: string; phone?: string; address?: string } = {}
  if (!form.value.name) currentErrors.name = '请输入收件人'
  const phone = form.value.phone
  if (!phone) {
    currentErrors.phone = '请输入手机号码'
  } else if (!/^1[3-9]\d{9}$/.test(phone)) {
    currentErrors.phone = '请输入有效的手机号'
  }
  if (!form.value.address) currentErrors.address = '请输入收件地址'
  errors.value = currentErrors
  return Object.keys(currentErrors).length === 0
}

const confirmForm = () => {
  // if (!validateForm()) return
  // TODO: 在此处提交表单到后端接口
  // 表单校验通过后，切换到二维码步骤，不关闭弹窗
  showSecondConfirm.value = true
}

const confirmSecond = async () => {
  await lotteryConfirm()
  showSecondConfirm.value = false
  step.value = 'qrcode'
}

const cancelSecond = () => {
  showSecondConfirm.value = false
}

const copyToken = async () => {
  try {
    const text = String(model.value?._id ?? '')
    if (!text) {
      ElMessage.warning('暂无可复制的口令')
      return
    }
    if (navigator.clipboard && window.isSecureContext) {
      await navigator.clipboard.writeText(text)
    } else {
      const textarea = document.createElement('textarea')
      textarea.value = text
      textarea.style.position = 'fixed'
      textarea.style.opacity = '0'
      document.body.appendChild(textarea)
      textarea.focus()
      textarea.select()
      document.execCommand('copy')
      document.body.removeChild(textarea)
    }
    ElMessage.success('口令已复制到剪贴板')
  } catch (error) {
    console.error(error)
    ElMessage.error('复制失败，请手动复制')
  }
}

// 生成噪点图片的工具函数
function generateNoise(opacity: number = 0.06, size: number = 100): string {
  const canvas = document.createElement('canvas');
  canvas.width = size;
  canvas.height = size;
  const ctx = canvas.getContext('2d');
  if (!ctx) return '';

  const imageData = ctx.createImageData(size, size);
  const buffer = imageData.data;

  for (let i = 0; i < buffer.length; i += 4) {
    const value = Math.random() * 255;
    buffer[i] = value;     // R
    buffer[i + 1] = value; // G
    buffer[i + 2] = value; // B
    buffer[i + 3] = Math.floor(opacity * 255); // Alpha
  }

  ctx.putImageData(imageData, 0, 0);
  return canvas.toDataURL();
}


const showDiaThree = ref(false)

const model = ref({}) as any

const draw = async () => {
  const res = await http.post('/lottery/draw', {
    openId: openIdStore.openId
  })
  model.value = res.data.data
}

const lotteryConfirm = async () => {
  const res = await http.post('/lottery/confirm', model.value)
  ElMessage.success('提交成功')

}

onMounted(async () => {
  await draw()
  // resolve backgrounds and card images with fallback
  fangxingBgUrl.value = await pickFirstReachable(makeOssCandidates('winning/fangxing.png'))
  changxingBgUrl.value = await pickFirstReachable(makeOssCandidates('winning/changxing.png'))

  cards.value = await Promise.all([
    pickFirstReachable(makeOssCandidates('winning/te.png')),
    pickFirstReachable(makeOssCandidates('winning/one.png')),
    pickFirstReachable(makeOssCandidates('winning/tow.png')),
  ])
  const targetDiv = document.querySelector('div.zaodian') as HTMLElement | null;
  if (targetDiv) {
    const noiseURL = generateNoise(0.08, 1000); // 不透明度 & 噪点尺寸
    targetDiv.style.backgroundImage = `url(${noiseURL})`;
    targetDiv.style.backgroundBlendMode = 'multiply';
    targetDiv.style.backgroundRepeat = 'repeat';
  }
})
</script>



<style scoped>
.cls-1 {
  fill: #fff;
}

.cls-2 {
  fill: none;
}

.cls-3 {
  fill: #ddcab5;
}

.cls-4 {
  fill: #50744e;
}

.cls-5 {
  clip-path: url(#clippath);
}

.cls-6 {
  fill: #9c7d5e;
}
</style>