<template>
  <div class="relative w-screen h-screen overflow-hidden ">
    <!-- 加载提示 -->
    <div v-if="loading"
      class="absolute inset-0 bg-black bg-opacity-80 flex flex-col justify-center items-center text-white z-[100]">
      <div class="w-12 h-12 border-3 border-gray-300 border-t-blue-500 rounded-full animate-spin mb-5"></div>
      <p>加载中... </p>
    </div>



    <!-- Three.js 渲染容器 -->
    <div ref="containerRef" class="w-full h-[55%] relative" style="background: transparent;"></div>



    <!-- 高级设置面板 -->
    <div v-show="showControlPanel"
      class="fixed top-16 right-5 bg-white bg-opacity-95 backdrop-blur-sm rounded-lg p-4 shadow-lg max-w-xs z-10 transition-all duration-300 max-h-[70vh] overflow-y-auto">
      <!-- 相机位置控制 -->
      <div class="mb-4">
        <label class="block mb-2 font-semibold text-gray-700 text-sm">相机位置:</label>
        <div class="space-y-2">
          <div>
            <label class="block text-xs text-gray-600 mb-1">X轴: {{ cameraPosition.x.toFixed(1) }}</label>
            <input type="range" v-model.number="cameraPosition.x" min="-20" max="20" step="0.1"
              @input="updateCameraPosition"
              class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
          </div>
          <div>
            <label class="block text-xs text-gray-600 mb-1">Y轴: {{ cameraPosition.y.toFixed(1) }}</label>
            <input type="range" v-model.number="cameraPosition.y" min="-20" max="20" step="0.1"
              @input="updateCameraPosition"
              class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
          </div>
          <div>
            <label class="block text-xs text-gray-600 mb-1">Z轴: {{ cameraPosition.z.toFixed(1) }}</label>
            <input type="range" v-model.number="cameraPosition.z" min="2" max="10" step="0.1"
              @input="updateCameraPosition"
              class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
          </div>
        </div>
      </div>

      <!-- 灯光控制 -->
      <div class="mb-4">
        <label class="block mb-2 font-semibold text-gray-700 text-sm">灯光强度:</label>
        <div class="space-y-2">
          <div>
            <label class="block text-xs text-gray-600 mb-1">环境光: {{ lightingIntensity.ambient.toFixed(1) }}</label>
            <input type="range" v-model.number="lightingIntensity.ambient" min="0" max="3" step="0.1"
              @input="updateLightingIntensity"
              class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
          </div>
          <div>
            <label class="block text-xs text-gray-600 mb-1">主光源: {{ lightingIntensity.directional.toFixed(1) }}</label>
            <input type="range" v-model.number="lightingIntensity.directional" min="0" max="3" step="0.1"
              @input="updateLightingIntensity"
              class="w-full h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
          </div>
        </div>
      </div>

      <!-- 其他控制 -->
      <div class="space-y-2">
        <button @click="toggleAnimation"
          :class="['w-full px-3 py-2 text-xs rounded border', isAnimating ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-700 border-gray-300']">
          {{ isAnimating ? '暂停旋转' : '开始旋转' }}
        </button>
        <button @click="resetView"
          class="w-full px-3 py-2 text-xs rounded border bg-white text-gray-700 border-gray-300">重置视角</button>
        <button @click="takeScreenshot"
          class="w-full px-3 py-2 text-xs rounded border bg-white text-gray-700 border-gray-300">截图</button>
      </div>
    </div>

    <!-- 主要控制面板 -->
    <div class=" absolute bottom-16">

      <div class="flex justify-center items-center">
        <svg width="108" height="45" viewBox="0 0 108 45" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M3.48078 6.0077L3.58487 6.70165C2.47455 7.11802 1.32953 7.53441 0.427394 7.84669L0.253906 7.08332C1.05195 6.87513 2.26637 6.42407 3.48078 6.0077ZM3.58487 3.33601V4.06465H0.392694V3.33601H3.58487ZM2.43986 1.01125V10.4837C2.43986 10.9348 2.33576 11.1429 2.09288 11.247C1.85 11.3858 1.43362 11.3858 0.774369 11.3858C0.739671 11.2123 0.670274 10.8654 0.566182 10.6572C1.05195 10.6572 1.46831 10.6572 1.57241 10.6572C1.7112 10.6572 1.74589 10.6225 1.74589 10.449V0.976562H2.43986V1.01125ZM6.01369 1.15005C5.59732 2.74614 4.93806 4.23815 4.14002 5.20968C4.03593 5.07089 3.72365 4.86269 3.55016 4.7586C4.3135 3.85646 4.97277 2.43386 5.31974 0.976562L6.01369 1.15005ZM8.99767 4.86271L9.20587 5.48724L3.96653 7.70789L3.75836 7.08332L8.99767 4.86271ZM5.52792 4.6198V10.1367C5.52792 10.5878 5.63201 10.7266 6.32596 10.7266C6.63824 10.7266 8.37313 10.7266 8.7895 10.7266C9.30996 10.7266 9.41404 10.5184 9.44874 9.40807C9.62222 9.51217 9.86512 9.61623 10.0733 9.68563C9.96922 11.0041 9.76103 11.3858 8.7895 11.3858C8.54661 11.3858 6.53415 11.3858 6.29127 11.3858C5.18095 11.3858 4.86868 11.1429 4.86868 10.1367V4.6198H5.52792ZM10.0039 2.60737V3.30132H5.00746V2.60737H10.0039ZM7.54037 3.68299V9.54687H6.91582V3.68299H7.54037ZM8.75479 5.0362L9.03238 4.7586L9.55285 4.93209L9.51814 5.07089C9.48344 6.32 9.41404 7.98545 9.27525 8.99168L8.7201 8.81819C8.82419 7.88136 8.85889 6.25061 8.85889 5.0362H8.75479Z"
            fill="#3F2917" />
          <path
            d="M15.6944 4.69198V5.38593H11.0449V4.69198H15.6944ZM11.1837 9.30673C11.3572 9.23733 11.496 8.95978 11.6695 8.50871C11.843 8.09234 12.3981 6.42684 12.641 4.93485L13.3349 5.17771C13.0227 6.7044 12.4675 8.40461 11.947 9.58432V9.61901C11.947 9.61901 11.4266 9.89657 11.4266 10.0354C11.3572 9.86188 11.2531 9.51491 11.1837 9.30673ZM11.3572 9.37615L11.7389 9.09855L15.2086 8.33522C15.2086 8.54341 15.278 8.85565 15.3127 8.99444C12.0511 9.75778 11.6695 9.89657 11.4266 10.0354L11.3572 9.37615ZM15.4862 1.95087V2.64482H11.4266V1.95087H15.4862ZM14.7576 6.42686C15.1739 7.46778 15.6597 8.85567 15.8332 9.61901L15.2086 9.86188C15.0004 9.02914 14.5494 7.64127 14.1677 6.60035L14.7576 6.42686ZM18.1232 1.1875C18.0885 5.07362 18.0538 9.27205 15.9026 11.458C15.7985 11.2845 15.5209 11.0416 15.3474 10.9375C17.3946 8.92508 17.4293 4.90017 17.4293 1.22223H18.1232V1.1875ZM20.101 3.65106V4.3797H15.8332V3.65106H20.101ZM20.4479 3.65106C20.4479 3.65106 20.4479 3.92862 20.4479 4.06741C20.3091 8.78627 20.1704 10.3823 19.7887 10.9028C19.5805 11.1804 19.3723 11.2845 19.06 11.3192C18.7478 11.3539 18.1579 11.3539 17.6027 11.2845C17.6027 11.0763 17.4987 10.764 17.3946 10.5211C18.0191 10.5905 18.5743 10.5906 18.8172 10.5906C18.9906 10.5906 19.1294 10.5559 19.2335 10.4171C19.5458 10.0354 19.6846 8.40462 19.8234 3.82454V3.65106H20.4479Z"
            fill="#3F2917" />
          <path
            d="M23.3279 3.30569C23.2932 7.01833 23.1891 9.79412 21.8359 11.4943C21.7318 11.3208 21.4889 11.1126 21.3154 10.9738C22.5645 9.44715 22.6339 6.81014 22.6686 3.30569H23.3279ZM25.6873 2.8893V3.61794H21.4889V2.8893H25.6873ZM23.4667 1.05036C23.779 1.57082 24.1259 2.19537 24.2994 2.64643L23.6402 2.92399C23.4667 2.50762 23.1544 1.81368 22.8421 1.29322L23.4667 1.05036ZM25.2362 5.17933C25.2362 5.17933 25.2362 5.42224 25.2362 5.56103C25.1668 9.37776 25.0975 10.6615 24.8199 11.0432C24.6811 11.2861 24.5076 11.3555 24.23 11.3902C23.9871 11.4249 23.5708 11.4249 23.1544 11.3902C23.1544 11.182 23.085 10.8697 22.9809 10.6962C23.3973 10.7309 23.779 10.7309 23.9177 10.7309C24.0565 10.7309 24.1606 10.6963 24.23 10.5922C24.4035 10.3146 24.5076 9.06545 24.577 5.35281V5.17933H25.2362ZM24.8199 5.17933V5.90801H22.9809V5.17933H24.8199ZM27.0058 6.32436C26.9364 8.40621 26.6936 10.3493 25.6873 11.4596C25.5832 11.3208 25.375 11.0779 25.2362 10.9738C26.1384 10.0023 26.3466 8.19802 26.3813 6.35905H27.0058V6.32436ZM27.561 1.15442C27.214 2.61172 26.6242 3.96495 25.8955 4.86708C25.7914 4.72829 25.4791 4.4854 25.3404 4.38131C26.0343 3.54857 26.5548 2.29943 26.867 1.01562L27.561 1.15442ZM30.5103 4.48538V5.17933H26.1731V4.48538H30.5103ZM29.6428 10.5574C29.851 10.5574 30.9613 10.5574 31.2389 10.5574C31.1348 10.7309 31.0654 11.0779 31.0307 11.2861H29.6081C28.0121 11.2861 26.9364 10.7657 26.3813 8.16335L26.867 7.98986C27.3181 10.1411 28.3243 10.5574 29.6428 10.5574ZM31.1348 2.50763V3.20159H26.6589V2.50763H31.1348ZM28.6713 4.86708V10.6269H28.012V4.86708H28.6713ZM30.7185 7.26118V7.92044H28.3243V7.26118H30.7185ZM30.4756 4.48538L30.5797 4.45069L31.0307 4.62417C30.7532 5.31812 30.4756 6.11619 30.198 6.60196L29.6428 6.35905C29.8857 5.90798 30.1633 5.17934 30.3368 4.58949V4.48538H30.4756Z"
            fill="#3F2917" />
          <path
            d="M36.3049 7.88138L36.3396 8.54064C34.8823 8.85291 33.3209 9.19988 32.1759 9.44276L32.0371 8.67943C33.078 8.50595 34.7088 8.19365 36.3049 7.88138ZM35.9579 2.36446V3.0931H32.0718V2.36446H35.9579ZM32.2106 6.04239C32.3841 6.00769 32.5229 5.62604 32.7311 5.10557C32.9045 4.61981 33.5291 2.71144 33.772 0.976562L34.4659 1.11536C34.0843 2.95433 33.4597 4.89741 32.8351 6.25061C32.8351 6.25061 32.3841 6.52817 32.3841 6.66696C32.4188 6.59757 32.3147 6.25058 32.2106 6.04239ZM32.4535 6.07712L32.8698 5.8689H36.0273V6.56285H33.2515C32.8698 6.56285 32.5576 6.63225 32.4882 6.73634V6.07712H32.4535ZM34.8476 4.09934V11.4205H34.1536V4.09934H34.8476ZM41.683 4.51573V5.24437H36.062V4.51573H41.683ZM41.3013 2.36446V3.0931H36.4784V2.36446H41.3013ZM39.4624 1.11536C38.9766 3.09312 38.2827 5.83422 37.7969 7.36091H37.0335C37.554 5.76483 38.3174 2.98901 38.7337 1.01125L39.4624 1.11536ZM37.6928 8.57533C38.7684 9.26928 39.9828 10.2408 40.6074 10.9L40.1563 11.4899C39.5318 10.8307 38.3174 9.75505 37.2417 9.0611L37.6928 8.57533ZM40.6768 6.63227V7.36091H37.5193V6.63227H40.6768ZM40.6421 6.63227L40.7462 6.59758L41.2319 6.87514C40.6421 7.81197 39.8093 9.06111 39.0807 10.0673L38.4561 9.75505C39.1848 8.78352 40.0522 7.46499 40.4686 6.73634V6.63227H40.6421Z"
            fill="#3F2917" />
          <path
            d="M47.3043 8.75319V9.41245H42.5508V8.75319H47.3043ZM47.4084 2.09128V2.7505H42.6202V2.09128H47.4084ZM46.9574 5.10995V7.81637H43.0018V5.10995H46.9574ZM44.1816 1.01562V3.68736H45.847V1.01562H46.5063V4.31189H43.5917V1.01562H44.1816ZM43.5917 7.1918H46.2981V5.69979H43.5917V7.1918ZM45.3266 3.99964V5.38755H44.6673V3.99964H45.3266ZM45.2919 5.42223V7.50408H45.3266V11.4943H44.6673V7.50408H44.702V5.42223H45.2919ZM52.2661 10.3493V11.0779H47.0268V10.3493H52.2661ZM52.162 5.04057V5.76921H47.3737V5.04057H52.162ZM51.9885 7.60815V8.3021H47.5125V7.60815H51.9885ZM51.9191 2.57701V3.27096H47.6513V2.57701H51.9191ZM50.1148 1.01562V5.38755H49.4209V1.01562H50.1148ZM50.1148 6.11618V10.9391H49.4209V6.11618H50.1148Z"
            fill="#3F2917" />
          <path
            d="M62.7093 6.11407V6.87739H53.2021V6.11407H62.7093ZM61.2173 1.77688V2.5402H54.2778V1.77688H61.2173ZM58.3374 4.44857V10.4513C58.3374 11.0064 58.1986 11.2146 57.8169 11.3534C57.4352 11.4922 56.776 11.4922 55.7351 11.4922C55.6657 11.284 55.5616 10.937 55.4228 10.6941C56.2902 10.7288 57.0883 10.7288 57.2965 10.7288C57.5046 10.7288 57.574 10.6594 57.574 10.4513V4.44857H58.3374ZM61.1479 1.77688L61.3214 1.74219L61.8418 2.19323C60.8703 3.23415 59.3436 4.34447 58.0945 5.00372C57.9904 4.83023 57.7822 4.58736 57.6434 4.44857C58.8231 3.85871 60.2804 2.7831 61.0091 1.98505V1.81157H61.1479V1.77688Z"
            fill="#3F2917" />
          <path
            d="M69.7532 1.87844L69.892 1.84375L70.343 1.98255C69.892 6.66671 68.4694 9.75481 66.5263 11.455C66.4222 11.2815 66.1793 11.0039 66.0059 10.8651C67.8448 9.40781 69.2327 6.28506 69.6491 2.08666V1.91317H69.7532V1.87844ZM69.892 1.87844V2.60712H66.2835V1.87844H69.892ZM66.9427 3.89091C68.2959 5.62579 69.8226 7.98521 70.5165 9.4772L69.9267 9.99766C69.3021 8.50567 67.7754 6.07684 66.4222 4.30726L66.9427 3.89091ZM74.6802 1.87844L74.819 1.84375L75.2701 1.98255C74.6802 6.97899 72.8066 9.9283 70.3084 11.455C70.2043 11.2815 69.9961 10.9692 69.8226 10.7957C72.1473 9.51192 74.021 6.5626 74.5415 2.05193V1.87844H74.6802ZM74.7843 1.87844V2.60712H70.7941V1.87844H74.7843ZM75.7212 10.8304C75.5477 11.0039 75.3048 11.2815 75.2007 11.4897C72.7372 9.92829 71.6616 6.73612 71.0717 2.60712L71.7309 2.50301C72.2514 6.35443 73.3617 9.47721 75.7212 10.8304Z"
            fill="#3F2917" />
          <path
            d="M80.1271 5.9427L80.1965 6.67134C78.9474 7.08771 77.6289 7.53878 76.6574 7.85106L76.4492 7.08769C77.3514 6.84481 78.7739 6.39376 80.1271 5.9427ZM80.0925 3.34038V4.06902H76.6227V3.34038H80.0925ZM78.8433 1.01562V10.5228C78.8433 10.9738 78.7392 11.182 78.4964 11.3208C78.2188 11.4249 77.8024 11.4596 77.1085 11.4596C77.0738 11.2861 76.9697 10.9738 76.8656 10.7657C77.3514 10.7657 77.8024 10.7657 77.9412 10.7657C78.08 10.7657 78.1494 10.7309 78.1494 10.5574V1.01562H78.8433ZM81.4804 1.05036V4.20782C81.4804 4.65889 81.5845 4.79766 82.0702 4.79766C82.4866 4.79766 84.499 4.79766 84.9154 4.79766C85.2624 4.79766 85.8176 4.76298 86.0604 4.72828C86.0951 4.93647 86.1298 5.21406 86.1645 5.38755C85.9563 5.45694 85.4706 5.45692 84.9848 5.45692C84.5684 5.45692 82.3825 5.45692 82.1049 5.45692C81.1334 5.45692 80.8211 5.10996 80.8211 4.17313V1.05036H81.4804ZM85.7481 6.49785V11.4249H85.0542V7.15711H81.4804V11.4596H80.8211V6.49785H85.7481ZM85.3318 10.2799V10.9391H81.1334V10.2799H85.3318ZM85.2971 8.37152V8.99605H81.1334V8.37152H85.2971ZM85.7828 2.43826V3.09748H81.1681V2.43826H85.7828Z"
            fill="#3F2917" />
          <path
            d="M89.1141 3.19721V5.97301C89.1141 7.88138 88.906 9.82445 87.4834 11.4552C87.3793 11.2817 87.1364 11.1083 86.9629 10.9695C88.2814 9.47747 88.4549 7.63848 88.4549 6.0077V3.2319H89.1141V3.19721ZM91.8552 2.85024V3.57888H87.1711V2.85024H91.8552ZM90.9184 5.17495V5.90363H88.8366V5.17495H90.9184ZM89.4958 0.976562C89.7387 1.46233 89.9816 2.08689 90.0857 2.50326L89.4264 2.74613C89.3223 2.32976 89.0794 1.6705 88.8713 1.18474L89.4958 0.976562ZM91.3348 5.17495C91.3348 5.17495 91.3348 5.41787 91.3348 5.55666C91.2654 9.33869 91.196 10.5878 90.9184 11.0042C90.7449 11.247 90.5714 11.3164 90.2938 11.3511C90.051 11.3858 89.5999 11.3858 89.1488 11.3511C89.1488 11.1429 89.0794 10.8307 88.9753 10.6225C89.4264 10.6572 89.8428 10.6572 90.0163 10.6572C90.1551 10.6572 90.2592 10.6225 90.3286 10.5184C90.502 10.2408 90.6061 8.99168 90.6755 5.34844V5.17495H91.3348ZM96.0883 3.61356C95.5332 7.56908 94.3535 9.99792 91.6471 11.5246C91.5777 11.3511 91.3695 11.0041 91.2307 10.8654C93.7983 9.54685 94.9086 7.22212 95.3944 3.54419L96.0883 3.61356ZM93.9024 1.11536C93.5207 3.26661 92.8615 5.31377 91.9593 6.63227C91.8552 6.49348 91.5777 6.21591 91.4042 6.07712C92.2716 4.86271 92.8615 2.95432 93.1738 0.976562L93.9024 1.11536ZM96.9211 10.796C96.7476 10.9348 96.5394 11.2471 96.4353 11.4552C94.2147 10.2061 93.1391 7.46499 92.5839 3.96054L93.2084 3.85647C93.6595 7.04864 94.7698 9.72035 96.9211 10.796ZM96.817 3.12783V3.85647H92.9309V3.12783H96.817Z"
            fill="#3F2917" />
          <path
            d="M102.924 1.01562C102.89 3.93022 102.855 9.20427 98.2402 11.4596C98.1361 11.2514 97.8932 11.0085 97.7197 10.835C102.23 8.71849 102.161 3.68733 102.196 1.01562H102.924ZM107.157 4.31189V5.07526H97.8932V4.31189H107.157ZM107.331 10.7309C107.157 10.9044 106.915 11.2167 106.81 11.4249C104.555 10.2799 103.098 7.85104 102.3 4.79766L102.994 4.62417C103.688 7.43467 105.145 9.7594 107.331 10.7309Z"
            fill="#3F2917" />
          <path
            d="M50.8773 44.4942C50.7732 44.4942 50.7038 44.4595 50.6344 44.3901C50.4956 44.2513 50.4956 44.0431 50.6344 43.9043L53.4796 41.0244L50.6344 38.1445C50.4956 38.0057 50.4956 37.7976 50.6344 37.6588C50.7732 37.52 50.9813 37.52 51.1201 37.6588L54.2082 40.7816C54.347 40.9203 54.347 41.1285 54.2082 41.2673L51.1201 44.3901C51.0507 44.4595 50.9813 44.4942 50.8773 44.4942Z"
            fill="#3F2917" />
          <path
            d="M53.9651 41.3703C45.2907 41.3703 38.2471 37.7271 38.2471 33.2164C38.2471 28.7057 45.2907 25.0625 53.9651 25.0625C62.6394 25.0625 69.683 28.7057 69.683 33.2164C69.683 36.478 65.9357 39.4273 60.1759 40.7111C60.0024 40.7458 59.7942 40.6417 59.7595 40.4335C59.7248 40.26 59.8289 40.0518 60.0371 40.0171C65.4846 38.8027 68.9891 36.131 68.9891 33.2164C68.9891 29.0874 62.2578 25.7565 53.9651 25.7565C45.6724 25.7565 38.941 29.0874 38.941 33.2164C38.941 37.3454 45.6724 40.6764 53.9651 40.6764C54.1732 40.6764 54.312 40.8152 54.312 41.0234C54.312 41.2315 54.1385 41.3703 53.9651 41.3703Z"
            fill="#3F2917" />
          <path
            d="M50.8773 44.4942C50.7732 44.4942 50.7038 44.4595 50.6344 44.3901C50.4956 44.2513 50.4956 44.0431 50.6344 43.9043L53.4796 41.0244L50.6344 38.1445C50.4956 38.0057 50.4956 37.7976 50.6344 37.6588C50.7732 37.52 50.9813 37.52 51.1201 37.6588L54.2082 40.7816C54.347 40.9203 54.347 41.1285 54.2082 41.2673L51.1201 44.3901C51.0507 44.4595 50.9813 44.4942 50.8773 44.4942Z"
            fill="#3F2917" />
          <path
            d="M50.8773 44.4942C50.7732 44.4942 50.7038 44.4595 50.6344 44.3901C50.4956 44.2513 50.4956 44.0431 50.6344 43.9043L53.4796 41.0244L50.6344 38.1445C50.4956 38.0057 50.4956 37.7976 50.6344 37.6588C50.7732 37.52 50.9813 37.52 51.1201 37.6588L54.2082 40.7816C54.347 40.9203 54.347 41.1285 54.2082 41.2673L51.1201 44.3901C51.0507 44.4595 50.9813 44.4942 50.8773 44.4942Z"
            fill="#3F2917" />
          <path
            d="M50.8773 44.4942C50.7732 44.4942 50.7038 44.4595 50.6344 44.3901C50.4956 44.2513 50.4956 44.0431 50.6344 43.9043L53.4796 41.0244L50.6344 38.1445C50.4956 38.0057 50.4956 37.7976 50.6344 37.6588C50.7732 37.52 50.9813 37.52 51.1201 37.6588L54.2082 40.7816C54.347 40.9203 54.347 41.1285 54.2082 41.2673L51.1201 44.3901C51.0507 44.4595 50.9813 44.4942 50.8773 44.4942Z"
            fill="#3F2917" />
          <path
            d="M50.8773 44.4942C50.7732 44.4942 50.7038 44.4595 50.6344 44.3901C50.4956 44.2513 50.4956 44.0431 50.6344 43.9043L53.4796 41.0244L50.6344 38.1445C50.4956 38.0057 50.4956 37.7976 50.6344 37.6588C50.7732 37.52 50.9813 37.52 51.1201 37.6588L54.2082 40.7816C54.347 40.9203 54.347 41.1285 54.2082 41.2673L51.1201 44.3901C51.0507 44.4595 50.9813 44.4942 50.8773 44.4942Z"
            fill="#3F2917" />
          <path
            d="M50.8773 44.4942C50.7732 44.4942 50.7038 44.4595 50.6344 44.3901C50.4956 44.2513 50.4956 44.0431 50.6344 43.9043L53.4796 41.0244L50.6344 38.1445C50.4956 38.0057 50.4956 37.7976 50.6344 37.6588C50.7732 37.52 50.9813 37.52 51.1201 37.6588L54.2082 40.7816C54.347 40.9203 54.347 41.1285 54.2082 41.2673L51.1201 44.3901C51.0507 44.4595 50.9813 44.4942 50.8773 44.4942Z"
            fill="#3F2917" />
        </svg>


      </div>

      <!-- 颜色选择区域 -->
      <div class="px-6 space-y-6">
        <!-- 区域1 颜色选择 -->
        <div>
          <div class="flex items-center justify-center mb-4">
            <h3 class="text-lg font-semibold text-gray-800">区域1</h3>
          </div>
          <div class="grid grid-cols-6 gap-x-4 gap-y-3 justify-items-center">
            <div v-for="texture in aTextureNames" :key="texture" class="flex flex-col items-center">
              <button type="button" @click="switchToATexture(texture)" :class="[
                'w-14 h-14 md:w-16 md:h-16 rounded-[18px] border border-gray-200 shadow-sm transition-transform duration-200',
                selectedATexture === texture ? 'ring-2 ring-offset-2 ring-blue-400 scale-105' : 'hover:scale-105'
              ]" :style="getSwatchStyle('A', texture)" />
              <div class="text-center leading-tight mt-2">
                <div class="text-[13px] text-gray-800">{{ getColorName('A', texture) }}</div>
                <!-- <div class="text-[11px] text-gray-500">{{ getColorEn('A', texture) }}</div> -->
              </div>
            </div>
          </div>
        </div>

        <!-- 分隔线 -->
        <div class="border-t border-gray-200"></div>

        <!-- 区域2 颜色选择 -->
        <div>
          <div class="flex items-center justify-center mb-4">
            <h3 class="text-lg font-semibold text-gray-800">区域2</h3>
          </div>
          <div class="grid grid-cols-6 gap-x-4 gap-y-3 justify-items-center">
            <div v-for="texture in bTextureNames" :key="texture" class="flex flex-col items-center">
              <button type="button" @click="switchToBTexture(texture)" :class="[
                'w-14 h-14 md:w-16 md:h-16 rounded-[18px] border border-gray-200 shadow-sm transition-transform duration-200',
                selectedBTexture === texture ? 'ring-2 ring-offset-2 ring-green-500 scale-105' : 'hover:scale-105'
              ]" :style="getSwatchStyle('B', texture)" />
              <div class="text-center leading-tight mt-2">
                <div class="text-[13px] text-gray-800">{{ getColorName('B', texture) }}</div>
                <!-- <div class="text-[11px] text-gray-500">{{ getColorEn('B', texture) }}</div> -->
              </div>
            </div>
          </div>
        </div>

        <!-- 定制完成按钮 -->
        <div class="flex justify-center mt-8" @click="showConfirm = true">
          <svg width="120" height="30" viewBox="0 0 120 30" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M38.1402 18.3119C37.7586 19.3528 37.1687 20.4978 36.5442 21.2264L35.7461 20.7753C36.3706 20.1508 36.9605 19.0752 37.3075 18.069L38.1402 18.3119ZM44.9409 12.899V17.2362H37.1687V12.899H44.9409ZM38.0014 16.2994H44.0735V13.8706H38.0014V16.2994ZM40.0139 18.3465C40.1874 19.2139 40.2915 20.3243 40.3262 20.9835L39.4587 21.1223C39.4587 20.4284 39.3546 19.3181 39.2158 18.416L40.0139 18.3465ZM41.4018 8.80469V13.4195H40.5344V8.80469H41.4018ZM45.8084 10.2273V11.1989H40.916V10.2273H45.8084ZM42.3733 18.2425C42.7203 19.0752 43.102 20.1508 43.2408 20.8448L42.408 21.0877C42.2692 20.3937 41.9223 19.2834 41.5753 18.4506L42.3733 18.2425ZM44.7328 17.9995C45.3226 18.8323 45.9819 19.9773 46.2595 20.7407L45.4267 21.157C45.1491 20.3937 44.5246 19.2139 43.9347 18.3465L44.7328 17.9995Z"
              fill="black" />
            <path
              d="M58.4036 14.044V15.0502H48.3066V14.044H58.4036ZM57.6056 10.8865V11.8928H49.1741V10.8865H57.6056ZM50.1803 16.0912V19.4915H57.1198V20.4978H49.2435V16.0912H50.1803ZM53.8236 8.80469V20.1508H52.9214V8.80469H53.8236ZM57.3974 16.0912V21.2611H56.53V16.0912H57.3974Z"
              fill="black" />
            <path
              d="M63.7124 19.2792C64.4758 19.8344 65.4473 19.9385 66.7658 19.9385C68.119 19.9385 69.8886 19.8344 70.9989 19.6956C70.8948 19.9732 70.756 20.4589 70.756 20.7365C69.9233 20.8059 67.8414 20.8753 66.7658 20.8753C65.3432 20.8753 64.3717 20.7365 63.5389 20.1467C63.0532 19.7997 62.6715 19.3486 62.4286 19.3486C62.0469 19.3486 61.4571 20.1467 60.8672 21.0835L60.2773 20.1467C61.0754 19.1405 61.8387 18.4465 62.4286 18.4465C62.8103 18.4118 63.0879 18.8282 63.7124 19.2792ZM62.845 18.9323H61.9775V14.6645H60.3814V13.6929H62.845V18.9323ZM61.3877 9.07812C62.0469 9.73738 62.8103 10.6742 63.1919 11.2641L62.5327 11.8887C62.1857 11.2641 61.3877 10.2925 60.7631 9.59859L61.3877 9.07812ZM70.756 14.6645V15.636H63.6777V14.6645H70.756ZM70.5478 11.2641V12.2356H63.7818V11.2641H70.5478ZM66.2453 9.07812V13.8317C66.2453 15.6012 66.0024 17.7872 64.4758 19.1751C64.3717 18.9669 64.0247 18.5852 63.8512 18.4465C65.2391 17.1973 65.3779 15.3931 65.3779 13.8317V9.11286H66.2453V9.07812ZM69.0211 9.07812V19.071H68.1537V9.07812H69.0211Z"
              fill="black" />
            <path
              d="M78.2505 12.4815C77.4177 16.6105 75.8911 19.4557 73.3235 21.2252C73.15 21.017 72.7683 20.6007 72.5254 20.3925C75.093 18.8311 76.5503 16.09 77.2443 12.2733L78.2505 12.4815ZM78.0423 9.60156V10.6425H74.746V9.60156H78.0423ZM78.4934 9.60156C78.4934 12.0304 78.7363 17.1657 83.3163 20.3231C83.1081 20.4966 82.7612 20.913 82.6224 21.1906C77.9729 17.929 77.5912 12.1692 77.5912 9.60156H78.4934Z"
              fill="black" />
            <path
              d="M112.914 29.5228L95.3219 29.488L77.7303 29.4533L42.547 29.3146L7.36372 29.1758H6.80857L6.25341 29.1411C5.87174 29.1064 5.49006 29.0369 5.14308 28.9328C4.41444 28.7247 3.72049 28.3777 3.13063 27.9267C1.91622 27.0245 1.08348 25.6367 0.805896 24.1447C0.736501 23.763 0.701808 23.3813 0.701808 22.9996V21.8893V19.7034C0.701808 18.2461 0.667108 16.7541 0.667108 15.2968C0.667108 13.8395 0.632406 12.3474 0.597709 10.8901L0.56302 8.70427L0.52832 7.59388V7.03877C0.52832 6.86529 0.52832 6.65712 0.52832 6.44893C0.632413 4.88755 1.32636 3.32612 2.50607 2.2505C3.65109 1.14018 5.24718 0.515625 6.84326 0.515625L24.4349 0.550356H33.2481L42.0612 0.585003L77.2445 0.758491L94.8362 0.793222C100.7 0.793222 106.564 0.82792 112.428 0.793222H112.983L113.573 0.827869C113.954 0.862566 114.336 0.931995 114.718 1.03609C115.446 1.24427 116.14 1.59121 116.765 2.04228C118.014 2.94442 118.882 4.33232 119.159 5.85901C119.228 6.24068 119.263 6.62237 119.263 7.00404V8.11435L119.298 10.3003L119.333 14.7069L119.367 19.1135L119.402 21.2994V22.4098V22.9649C119.402 23.1384 119.402 23.3466 119.367 23.5547C119.263 25.1508 118.5 26.6776 117.355 27.7879C116.106 28.8982 114.51 29.5228 112.914 29.5228ZM112.914 28.3777C114.232 28.3777 115.551 27.8919 116.557 26.9551C117.528 26.053 118.188 24.7692 118.292 23.4507L118.396 14.7069L118.43 10.3003L118.465 8.11435V7.00404C118.465 6.65707 118.465 6.31009 118.396 5.96312C118.188 4.60991 117.424 3.32616 116.314 2.45872C115.759 2.04235 115.134 1.69531 114.44 1.52182C114.093 1.41773 113.746 1.34838 113.399 1.31368L112.879 1.27895H112.324C106.46 1.24426 100.596 1.24426 94.732 1.27895L77.1404 1.31368L41.9571 1.48717L33.144 1.52182H24.3308L6.73917 1.55655C5.38597 1.55655 4.06746 2.07705 3.09593 2.97918C2.08971 3.88132 1.43045 5.13041 1.29166 6.51831C1.29166 6.6918 1.25697 6.86529 1.25697 7.03877V7.59388L1.22227 8.70427L1.18757 10.8901C1.15287 12.3474 1.11817 13.8395 1.11817 15.2968C1.11817 16.7541 1.08348 18.2461 1.08348 19.7034V21.8893V22.9996C1.08348 23.3466 1.11818 23.6935 1.18757 24.0752C1.43045 25.4631 2.2285 26.7817 3.33882 27.6144C3.89398 28.0655 4.55323 28.3777 5.24718 28.5512C5.59416 28.6553 5.94113 28.69 6.28811 28.7594L6.80857 28.7941H7.36372L42.547 28.6553L77.7303 28.5165L95.3219 28.4819L112.914 28.3777Z"
              fill="black" />
          </svg>

        </div>

        <!-- 全屏对话框弹窗（覆盖层） -->
        <div v-if="showConfirm" class="fixed inset-0 z-[200]">
          <!-- 背景遮罩 -->
          <div class="absolute inset-0 bg-black bg-opacity-60"></div>
          <!-- 居中内容容器 -->
          <div class="absolute inset-0 flex items-center justify-center">

            <svg width="307" height="143" viewBox="0 0 307 143" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M302.744 0.4375H3.79517C1.88685 0.4375 0.339844 1.98604 0.339844 3.89625V119.419C0.339844 121.329 1.88685 122.877 3.79517 122.877H302.744C304.652 122.877 306.199 121.329 306.199 119.419V3.89625C306.199 1.98604 304.652 0.4375 302.744 0.4375Z"
                fill="#DDCAB5" />
              <path
                d="M122.801 61.5627C122.344 64.9212 121.567 68.034 120.219 70.0955C120.021 69.729 119.79 69.3817 119.528 69.0578C120.738 67.2454 121.377 64.3989 121.74 61.3932L122.801 61.5627ZM125.326 60.9367V62.0262H119.846V60.9367H125.326ZM121.951 65.6683V73.8102H120.962V65.6683H121.951ZM124.825 65.6683V72.482H121.446V71.4133H123.827V66.7474H121.446V65.6855L124.825 65.6683ZM126.957 64.1222V68.3315C126.957 70.3134 126.698 72.9697 125.14 74.7163C124.92 74.422 124.654 74.1651 124.352 73.9554C125.776 72.361 125.938 70.1058 125.938 68.3246V64.1291L126.957 64.1222ZM128.567 60.3383C127.946 62.3012 126.955 64.1268 125.648 65.7167C125.397 65.4305 125.123 65.1656 124.829 64.9246C126.085 63.5235 127.014 61.8599 127.548 60.0547L128.567 60.3383ZM132.168 69.677V70.7146H126.46V69.677H132.168ZM132.168 64.1084V65.146H126.529V64.1084H132.168ZM132.168 66.8754V67.8335H126.529V66.8754H132.168ZM130.513 61.3898V62.3893H127.106L127.562 61.3898H130.513ZM129.756 64.5995V70.1335H128.789V64.5995H129.756ZM130.416 61.3898L130.582 61.331L131.301 61.8533C130.841 62.8727 130.284 63.8446 129.635 64.7552C129.395 64.5634 129.141 64.39 128.875 64.2364C129.413 63.4168 129.85 62.5353 130.178 61.6111V61.3898H130.416ZM132.71 64.1187V73.2983C132.71 73.9554 132.583 74.3082 132.171 74.4881C131.76 74.668 131.069 74.6991 130.053 74.6991C129.988 74.3075 129.872 73.9261 129.708 73.5646C130.451 73.5957 131.173 73.5957 131.38 73.5853C131.587 73.575 131.65 73.5058 131.65 73.2913V64.1187H132.71Z"
                fill="black" />
              <path
                d="M137.645 65.0501V66.2019H134.452V65.0501H137.645ZM136.584 60.3808C137.317 61.0726 138.312 62.0445 138.816 62.629L138.06 63.4937C137.583 62.8849 136.591 61.8508 135.855 61.121L136.584 60.3808ZM136.118 73.1782C136.358 73.0006 136.555 72.7714 136.695 72.5074C136.835 72.2435 136.914 71.9514 136.926 71.6529V65.0501H137.99V72.5106C137.99 72.5106 136.726 73.5725 136.726 74.036C136.567 73.7211 136.362 73.4319 136.118 73.1782ZM136.529 72.9361L136.847 72.4346L139.801 70.2901C139.889 70.631 140.004 70.9642 140.147 71.2863C137.341 73.4099 136.957 73.7489 136.743 74.0533L136.529 72.9361ZM143.992 60.0938C143.961 65.773 143.899 71.6494 140.057 74.6897C139.825 74.364 139.538 74.0809 139.21 73.8526C142.918 71.0407 142.852 65.4687 142.88 60.0938H143.992ZM147.945 73.7904C147.629 74.0349 147.356 74.3307 147.137 74.6655C143.788 72.2098 143.156 66.6688 142.88 65.0259L143.858 64.9291C144.055 66.3748 144.697 71.5215 147.945 73.78V73.7904Z"
                fill="black" />
              <path
                d="M152.806 67.5183C152.406 70.7246 151.49 73.1422 149.835 74.709C149.564 74.4163 149.266 74.151 148.943 73.917C150.581 72.5335 151.362 70.2749 151.708 67.3938L152.806 67.5183ZM161.849 61.8529V65.3116H160.726V62.9804H150.706V65.3116H149.621V61.8529H161.849ZM158.68 73.2252C159.226 73.2252 161.749 73.2252 162.481 73.2045C162.278 73.5818 162.137 73.9894 162.063 74.4116H158.636C155.142 74.4116 152.761 73.6749 151.507 69.8011L152.399 69.431C153.425 72.6615 155.705 73.2183 158.68 73.2252ZM160.042 64.9623V66.1071H151.5V64.9623H160.042ZM155.726 59.9609C156.088 60.5774 156.379 61.233 156.593 61.9151L155.46 62.2956C155.257 61.6021 154.984 60.9311 154.645 60.293L155.726 59.9609ZM156.279 65.4949V73.5331L155.142 73.3636V65.4949H156.279ZM160.65 68.7012V69.8253H155.719V68.7012H160.65Z"
                fill="black" />
              <path
                d="M166.158 60.6689C165.853 62.204 165.337 63.6893 164.624 65.0823C164.31 64.9127 163.984 64.7659 163.649 64.643C164.32 63.5742 164.824 61.9832 165.128 60.4441L166.158 60.6689ZM171.894 65.1168V66.2202H163.705V65.1168H171.894ZM170.774 67.8285V68.9077H165.374V73.3625H164.378V67.8285H170.774ZM171.313 62.3602V63.4532H164.911L165.111 62.3602H171.313ZM168.331 60.1328V74.6596H167.295V60.1328H168.331ZM171.376 67.8285V72.1866C171.376 72.7261 171.293 73.034 170.93 73.2242C170.567 73.4144 170.021 73.4179 169.202 73.411C169.148 73.052 169.044 72.7026 168.891 72.3733C169.315 72.3981 169.739 72.3981 170.163 72.3733C170.315 72.3733 170.36 72.3214 170.36 72.1623V67.8216L171.376 67.8285ZM173.981 61.5232V70.3223H172.944V61.5232H173.981ZM176.628 60.2331V73.0305C176.628 73.8225 176.455 74.1753 176.006 74.3898C175.556 74.6042 174.758 74.6215 173.663 74.6215C173.586 74.1933 173.471 73.7731 173.317 73.366C174.181 73.3971 175.004 73.3971 175.27 73.3867C175.536 73.3764 175.574 73.3072 175.574 73.0409V60.2435L176.628 60.2331Z"
                fill="black" />
              <path
                d="M185.239 64.4125C185.239 63.316 184.513 62.5205 183.02 62.5205C182.018 62.5205 181.099 62.9943 180.256 63.9559L179.472 63.1673C180.436 62.0571 181.579 61.3203 183.165 61.3203C185.239 61.3203 186.555 62.4686 186.555 64.2914C186.555 66.7125 183.058 67.1829 183.445 69.566H182.25C181.794 66.9235 185.239 66.2145 185.239 64.4125ZM181.925 72.4368C181.909 72.3036 181.921 72.1686 181.961 72.0405C182.001 71.9125 182.067 71.7944 182.156 71.694C182.245 71.5937 182.354 71.5133 182.476 71.4583C182.598 71.4032 182.731 71.3748 182.865 71.3748C182.999 71.3748 183.131 71.4032 183.253 71.4583C183.376 71.5133 183.485 71.5937 183.574 71.694C183.662 71.7944 183.729 71.9125 183.769 72.0405C183.809 72.1686 183.821 72.3036 183.805 72.4368C183.816 72.5671 183.8 72.6983 183.758 72.8221C183.716 72.9459 183.648 73.0596 183.56 73.156C183.471 73.2524 183.364 73.3293 183.244 73.3819C183.125 73.4345 182.995 73.4618 182.865 73.4618C182.734 73.4618 182.605 73.4345 182.485 73.3819C182.366 73.3293 182.258 73.2524 182.17 73.156C182.082 73.0596 182.014 72.9459 181.972 72.8221C181.93 72.6983 181.914 72.5671 181.925 72.4368Z"
                fill="black" />
              <path
                d="M126.681 107.617H29.6073C27.3173 107.617 25.4609 109.475 25.4609 111.768V137.968C25.4609 140.26 27.3173 142.118 29.6073 142.118H126.681C128.971 142.118 130.828 140.26 130.828 137.968V111.768C130.828 109.475 128.971 107.617 126.681 107.617Z"
                fill="#9C7D5E"
                @click=" $router.push({ path: `/result/${selectedATexture}/${selectedBTexture}` })" />
              <path
                d="M55.6637 126.759C55.4944 130.021 54.869 131.688 51.3998 132.487C51.277 132.157 51.0955 131.852 50.8643 131.587C54.0397 130.923 54.4993 129.588 54.6444 126.745L55.6637 126.759ZM62.8543 126.105V127.143H51.0301V126.105H62.8543ZM62.4915 120.831V124.04H61.4549V121.879H52.3673V124.04H51.3687V120.831H62.4915ZM60.5565 123.418V124.421H53.3003V123.418H60.5565ZM56.9007 119.039C57.2769 119.687 57.5893 120.371 57.8337 121.08L56.7729 121.426C56.5466 120.707 56.2516 120.012 55.8918 119.35L56.9007 119.039ZM58.9739 126.714V130.747C58.9739 131.169 59.0707 131.238 59.6201 131.238H61.486C61.987 131.238 62.0699 130.989 62.1148 129.318C62.3938 129.516 62.7048 129.663 63.0339 129.754C62.913 131.743 62.6331 132.245 61.5654 132.245H59.5164C58.2898 132.245 57.9684 131.899 57.9684 130.75V126.714H58.9739Z"
                fill="white" />
              <path
                d="M67.1597 121.628V125.706C67.1597 127.754 66.9593 130.673 65.7361 132.572C65.4938 132.291 65.2107 132.049 64.8965 131.853C66.0056 130.075 66.1231 127.578 66.1231 125.693V121.628H67.1597ZM70.0035 124.593V125.603H66.6933V124.593H70.0035ZM77.0903 121.628V122.69H66.7693V121.628H77.0903ZM70.5805 124.593C70.5805 124.593 70.5805 124.914 70.5805 125.06C70.5148 128.314 70.4388 129.556 70.1624 129.933C70.0663 130.056 69.9444 130.157 69.8054 130.228C69.6663 130.299 69.5134 130.339 69.3573 130.345C68.8224 130.381 68.2855 130.381 67.7506 130.345C67.7252 129.992 67.6313 129.648 67.4742 129.331C68.0823 129.393 68.6593 129.4 68.8874 129.4C68.9645 129.411 69.0432 129.403 69.1162 129.376C69.1893 129.349 69.2543 129.303 69.3055 129.245C69.499 128.989 69.5646 127.903 69.6165 124.776V124.596L70.5805 124.593ZM76.2749 124.091C75.1346 127.858 73.1478 130.663 70.4181 132.392C70.1992 132.076 69.9541 131.779 69.6856 131.503C72.3842 129.947 74.2708 127.301 75.2728 123.811L76.2749 124.091ZM72.7021 119.18C72.6744 125.841 73.9805 131.247 75.7082 131.247C76.0883 131.247 76.2576 130.5 76.3302 128.577C76.5774 128.83 76.8722 129.031 77.1975 129.169C77.0178 131.645 76.6446 132.358 75.6287 132.358C72.9163 132.358 71.7139 126.104 71.662 119.18H72.7021ZM73.9633 119.221C74.8295 119.679 75.641 120.233 76.382 120.874L75.7531 121.615C75.028 120.949 74.2293 120.369 73.3724 119.885L73.9633 119.221Z"
                fill="white" />
              <path
                d="M85.4868 119.789V120.716H79.167V119.789H85.4868ZM85.2277 122.594V132.234H84.3915V123.521H80.2209V132.427H79.4123V122.594H85.2277ZM84.5677 130.518V131.4H79.7475V130.518H84.5677ZM81.8691 123.255V124.614C81.9003 125.137 81.8123 125.661 81.6117 126.145C81.4112 126.629 81.1034 127.061 80.7115 127.409C80.5668 127.228 80.3942 127.071 80.2001 126.945C80.5469 126.666 80.8219 126.308 81.0022 125.9C81.1825 125.493 81.2629 125.048 81.2367 124.604V123.255H81.8691ZM83.8455 128.187V129.052H80.7737V128.187H83.8455ZM81.8483 120.111V123.272H81.0467V120.111H81.8483ZM83.576 120.111V123.272H82.7744V120.111H83.576ZM83.4412 123.251V125.776C83.4412 125.963 83.4723 125.987 83.6313 125.987H84.1772C84.3362 125.987 84.3707 125.987 84.3984 125.946C84.5729 126.076 84.7731 126.168 84.9858 126.215C84.9028 126.561 84.7024 126.713 84.2947 126.713H83.5725C82.9782 126.713 82.802 126.551 82.802 125.787V123.251H83.4412ZM90.9255 119.837V125.589H86.2297V124.552H89.9649V120.868H86.0189V119.831L90.9255 119.837ZM87.0348 124.555V130.684C87.0348 131.21 87.1454 131.314 87.7431 131.314H89.7541C90.3381 131.314 90.4452 130.94 90.5005 128.868C90.7767 129.074 91.09 129.224 91.4231 129.311C91.3021 131.67 91.0188 132.334 89.8267 132.334H87.636C86.4197 132.334 86.0535 131.988 86.0535 130.681V124.555H87.0348Z"
                fill="white" />
              <path
                d="M98.2958 119.492C97.2256 121.637 95.6711 123.503 93.7555 124.943C93.6052 124.587 93.4188 124.247 93.1992 123.929C94.9872 122.718 96.4303 121.062 97.3871 119.125L98.2958 119.492ZM95.9116 123.179V130.152C95.9116 131.023 96.1846 131.227 97.6393 131.227H102.86C104.173 131.227 104.381 130.826 104.536 128.906C104.832 129.099 105.159 129.237 105.504 129.314C105.272 131.573 104.861 132.23 102.864 132.23H97.7153C95.5938 132.23 94.9338 131.826 94.9338 130.155V123.192L95.9116 123.179ZM104.153 123.179V128.388H103.161V124.196H95.656V123.179H104.153ZM103.638 126.707V127.744H95.656V126.707H103.638ZM101.388 120.436V121.411H96.6718L97.1279 120.436H101.388ZM99.9717 123.521V127.357H98.9869V123.521H99.9717ZM101.312 120.436L101.516 120.37L102.169 120.882C101.475 122.033 100.632 123.087 99.6607 124.016C99.4802 123.783 99.279 123.568 99.0595 123.372C99.8704 122.581 100.552 121.667 101.081 120.664V120.436H101.312Z"
                fill="white" />
              <path
                d="M271.543 107.617H174.469C172.179 107.617 170.322 109.475 170.322 111.768V137.968C170.322 140.26 172.179 142.118 174.469 142.118H271.543C273.833 142.118 275.689 140.26 275.689 137.968V111.768C275.689 109.475 273.833 107.617 271.543 107.617Z"
                fill="#50744E" @click="showConfirm = false" />
              <path
                d="M207.967 127.957V128.97H195.67V127.957H207.967ZM207.473 120.047V121.064H196.164V120.047H207.473ZM205.77 122.468V123.468H198.237V132.488H197.252V122.458L205.77 122.468ZM205.742 125.2V126.152H197.909V125.2H205.742ZM202.256 120.358V128.313H201.25V120.358H202.256ZM206.35 122.465V131.111C206.35 131.776 206.205 132.104 205.763 132.27C205.321 132.436 204.581 132.46 203.431 132.46C203.35 132.101 203.227 131.753 203.064 131.423C203.945 131.457 204.792 131.443 205.034 131.423C205.276 131.402 205.359 131.343 205.359 131.077V122.43L206.35 122.465Z"
                fill="white" />
              <path
                d="M214.543 128.343L214.654 129.301C212.995 129.817 211.24 130.339 209.948 130.733L209.72 129.696C210.915 129.377 212.76 128.862 214.543 128.343ZM214.367 120.284V121.322H209.903V120.284H214.367ZM214.17 124.507V125.521H210.1V124.507H214.17ZM212.629 120.703V129.488L211.658 129.689V120.696L212.629 120.703ZM217.235 125.033C217.093 128.869 216.655 131.259 213.614 132.508C213.464 132.206 213.265 131.932 213.026 131.695C215.843 130.598 216.136 128.499 216.257 125.033H217.235ZM222.041 124.376V125.414H214.44V124.376H222.041ZM221.35 120.188V121.225H215.037V120.188H221.35ZM219.726 125.03V130.91C219.726 131.318 219.771 131.383 220.072 131.383H220.988C221.267 131.383 221.333 131.11 221.354 129.398C221.62 129.61 221.927 129.766 222.256 129.855C222.169 131.85 221.91 132.411 221.077 132.411H219.916C218.973 132.411 218.742 132.065 218.742 130.917V125.037L219.726 125.03Z"
                fill="white" />
              <path d="M236.19 125.086V126.272H223.993V125.086H236.19Z" fill="white" />
              <path
                d="M242.411 127.418V128.491H238.195V127.418H242.411ZM242 121.449V122.486H238.489V121.449H242ZM245.987 123.316V124.465C245.987 126.858 245.617 130.223 241.523 132.524C241.316 132.202 241.063 131.912 240.773 131.662C244.633 129.546 244.937 126.53 244.937 124.44V123.33L245.987 123.316ZM244.695 119.398C244.215 121.878 243.42 124.24 242.421 125.779C242.111 125.544 241.781 125.334 241.436 125.153C242.456 123.745 243.195 121.487 243.603 119.18L244.695 119.398ZM249.187 121.653V122.725H243.016L243.461 121.653H249.187ZM250.396 131.434C250.119 131.714 249.886 132.035 249.705 132.385C247.041 131.199 245.714 128.556 245.054 124.907L245.911 124.748C246.498 127.989 247.836 130.462 250.386 131.434H250.396ZM249.035 121.653L249.228 121.59L249.964 122.026C249.624 123.381 249.155 124.7 248.565 125.966C248.351 125.841 247.957 125.62 247.718 125.513C248.236 124.362 248.627 123.158 248.886 121.922V121.653H249.035Z"
                fill="white" />
            </svg>


          </div>
        </div>




      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, onUnmounted, nextTick } from 'vue'
import * as THREE from 'three'
import { getClonedGLTF } from '@/util/gltfCache'
import { loadTextureFromCandidates } from '@/util/textureCache'
import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'
import { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js'


// 基础路径适配（改为使用 OSS 加速）
const withBase = (path: string): string => {
  const base = 'https://steppy-dev.oss-cn-guangzhou.aliyuncs.com'
  const cleaned = path.replace(/^\/+/, '')
  return `${base}/${cleaned}`
}

// 贴图路径（A/B）
const getTexturePath = (folder: 'A' | 'B', filename: string): string => {
  const base = 'https://steppy-dev.oss-cn-guangzhou.aliyuncs.com'
  return `${base}/tietu/${folder}/${filename}`
}

// 响应式数据
const containerRef = ref<HTMLElement>()
const loading = ref(true)
const loadingProgress = ref(0)
const error = ref('')
const selectedEnvironment = ref('studio')
const isAnimating = ref(true)
const showGestureHint = ref(true)
const showControlPanel = ref(false)
const cameraPosition = ref({ x: 0, y: 0, z: 5 })
// 确认弹窗
const showConfirm = ref(false)

// A和B贴图文件名数组
const aTextureNames = ['A1.png', 'A2.png', 'A3.png', 'A4.png', 'A5.png', 'A6.png',]
const bTextureNames = ['B2.png', 'B1.png', 'B3.png', 'B4.png', 'B5.png', 'B6.png',]

// 当前选中的贴图
const selectedATexture = ref('A2.png')
const selectedBTexture = ref('B3.png')

// 贴图缓存
const textureCache: Record<string, THREE.Texture> = {}

// 添加灯光强度控制
const lightingIntensity = ref({
  ambient: 3.0,
  directional: 3.0,
  fill: 2.0,
  additional: 1.5
})

// 添加Mesh列表
const meshList = ref<Array<{ name: string, index: number, mesh: THREE.Mesh }>>([])



// Three.js 相关变量
let scene: THREE.Scene
let camera: THREE.PerspectiveCamera
let renderer: THREE.WebGLRenderer
let controls: OrbitControls
let shoeModel: THREE.Group
let mixer: THREE.AnimationMixer
let animationId: number

// 添加灯光对象引用
let ambientLight: THREE.AmbientLight
let directionalLight: THREE.DirectionalLight
let fillLight: THREE.DirectionalLight
let topLight: THREE.DirectionalLight
let bottomLight: THREE.DirectionalLight
let leftLight: THREE.DirectionalLight
let rightLight: THREE.DirectionalLight
let spotLight: THREE.SpotLight

// 切换控制面板显示
const toggleControlPanel = () => {
  showControlPanel.value = !showControlPanel.value
}

// 更新相机位置
const updateCameraPosition = () => {
  if (camera) {
    camera.position.set(cameraPosition.value.x, cameraPosition.value.y, cameraPosition.value.z)
    camera.updateProjectionMatrix()
  }
}

// 更新灯光强度
const updateLightingIntensity = () => {
  if (ambientLight) ambientLight.intensity = lightingIntensity.value.ambient
  if (directionalLight) directionalLight.intensity = lightingIntensity.value.directional
  if (fillLight) fillLight.intensity = lightingIntensity.value.fill
  if (topLight) topLight.intensity = lightingIntensity.value.additional
  if (bottomLight) bottomLight.intensity = lightingIntensity.value.additional * 0.8
  if (leftLight) leftLight.intensity = lightingIntensity.value.additional
  if (rightLight) rightLight.intensity = lightingIntensity.value.additional
  if (spotLight) spotLight.intensity = lightingIntensity.value.directional * 0.8
}

// 获取指定Mesh的函数
const getMeshByName = (name: string): THREE.Mesh | null => {
  const found = meshList.value.find(item => item.name === name)
  return found ? found.mesh : null
}

const getMeshByIndex = (index: number): THREE.Mesh | null => {
  const found = meshList.value.find(item => item.index === index)
  return found ? found.mesh : null
}

// 控制台打印 Mesh 名称/索引/父级
const logMeshNames = (limit: number = 200) => {
  if (!meshList.value.length) {
    console.warn('[Mesh] 当前 meshList 为空')
    return
  }
  const rows = meshList.value.slice(0, limit).map(({ name, index, mesh }) => {
    const parents: string[] = []
    let p: any = mesh.parent
    let depth = 0
    while (p && depth < 5) {
      parents.push(String(p.name || ''))
      p = p.parent
      depth++
    }
    return {
      index,
      name,
      parentChain: parents.join(' > '),
      materialType: Array.isArray(mesh.material) ? 'Array' : (mesh.material as any)?.type || 'Unknown'
    }
  })
  console.log(`[Mesh] 共 ${meshList.value.length} 个，以下展示前 ${rows.length} 个：`)
  // @ts-ignore console.table 在浏览器存在
  console.table(rows)
}



const switchToATexture = (textureName: string) => {
  if (!aTextureNames.includes(textureName)) {
    return
  }

  selectedATexture.value = textureName

  // 使用环境适配的路径
  const texturePath = getTexturePath('A', textureName)
  applyTextureToMeshA(texturePath)
}



const switchToBTexture = (textureName: string) => {
  if (!bTextureNames.includes(textureName)) {
    return
  }

  selectedBTexture.value = textureName


  // 使用环境适配的路径
  const texturePath = getTexturePath('B', textureName)
  applyTextureToMeshB(texturePath)
}

// 应用贴图到A mesh
const applyTextureToMeshA = (texturePath: string) => {
  if (!shoeModel) return

  const fileName = texturePath.split('/').pop()!
  const candidates = [
    texturePath,
    `/assets/tietu/A/${fileName}`,
    `./tietu/A/${fileName}`,
    `./src/assets/tietu/A/${fileName}`,
  ]

  loadTextureFromCandidates(candidates)
    .then((texture) => {
      texture.wrapS = THREE.ClampToEdgeWrapping
      texture.wrapT = THREE.ClampToEdgeWrapping
      texture.repeat.set(1, 1)
      texture.offset.set(0, 0)
      texture.minFilter = THREE.LinearMipmapLinearFilter
      texture.magFilter = THREE.LinearFilter
      texture.flipY = false

      let appliedCount = 0
      shoeModel!.traverse((child) => {
        if (child instanceof THREE.Mesh) {
          const meshName = child.name.trim()
          if (meshName === 'A') {
            if (child.material instanceof THREE.MeshStandardMaterial) {
              const newMaterial = child.material.clone()
              newMaterial.map = texture
              newMaterial.needsUpdate = true
              child.material = newMaterial
              appliedCount++
            } else if (Array.isArray(child.material)) {
              child.material = child.material.map((mat) => {
                if (mat instanceof THREE.MeshStandardMaterial) {
                  const newMat = mat.clone()
                  newMat.map = texture
                  newMat.needsUpdate = true
                  return newMat
                }
                return mat
              })
              appliedCount++
            }
          }
        }
      })
    })
    .catch(() => { })
}

// 应用贴图到B mesh
const applyTextureToMeshB = (texturePath: string) => {
  if (!shoeModel) return

  const fileName = texturePath.split('/').pop()!
  const candidates = [
    texturePath,
    `/assets/tietu/B/${fileName}`,
    `./tietu/B/${fileName}`,
    `./src/assets/tietu/B/${fileName}`,
  ]

  loadTextureFromCandidates(candidates)
    .then((texture) => {
      texture.wrapS = THREE.ClampToEdgeWrapping
      texture.wrapT = THREE.ClampToEdgeWrapping
      texture.repeat.set(1, 1)
      texture.offset.set(0, 0)
      texture.minFilter = THREE.LinearMipmapLinearFilter
      texture.magFilter = THREE.LinearFilter
      texture.flipY = false

      let appliedCount = 0
      shoeModel!.traverse((child) => {
        if (child instanceof THREE.Mesh) {
          const meshName = child.name.trim()
          if (meshName === 'B') {
            if (child.material instanceof THREE.MeshStandardMaterial) {
              const newMaterial = child.material.clone()
              newMaterial.map = texture
              newMaterial.needsUpdate = true
              child.material = newMaterial
              appliedCount++
            } else if (Array.isArray(child.material)) {
              child.material = child.material.map((mat) => {
                if (mat instanceof THREE.MeshStandardMaterial) {
                  const newMat = mat.clone()
                  newMat.map = texture
                  newMat.needsUpdate = true
                  return newMat
                }
                return mat
              })
              appliedCount++
            }
          }
        }
      })
    })
    .catch(() => { })
}




// 初始化Three.js
const initThree = async () => {
  if (!containerRef.value) return

  try {
    // 创建场景
    scene = new THREE.Scene()
    // 移除场景背景，保持透明
    scene.background = null
    // 确保没有雾效
    scene.fog = null
    // 确保没有环境贴图
    scene.environment = null

    // 创建相机
    const container = containerRef.value
    camera = new THREE.PerspectiveCamera(
      50, // 减小视野角度，让模型看起来更合适
      container.clientWidth / container.clientHeight,
      0.1,
      1000
    )
    camera.position.set(cameraPosition.value.x, cameraPosition.value.y, cameraPosition.value.z) // 使用响应式数据中的相机位置

    // 创建渲染器
    renderer = new THREE.WebGLRenderer({
      antialias: true,
      alpha: true, // 启用透明背景
      preserveDrawingBuffer: true, // 用于截图
      premultipliedAlpha: false // 确保透明度正确处理
    })


    renderer.setSize(container.clientWidth, container.clientHeight)
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
    renderer.shadowMap.enabled = true
    renderer.shadowMap.type = THREE.PCFSoftShadowMap
    // 禁用色调映射，避免颜色偏移
    renderer.toneMapping = THREE.ACESFilmicToneMapping
    renderer.toneMappingExposure = 2.0  // 标准曝光度
    renderer.outputColorSpace = THREE.SRGBColorSpace
    // 设置完全透明背景
    renderer.setClearColor(0x000000, 0) // 完全透明


    // 禁用任何可能的颜色处理
    renderer.autoClear = true
    renderer.autoClearColor = true
    renderer.autoClearDepth = true
    renderer.autoClearStencil = true
    // 确保canvas元素也是透明的
    renderer.domElement.style.background = 'transparent'
    renderer.domElement.style.opacity = '1'

    // 确保canvas能接收鼠标事件
    renderer.domElement.style.pointerEvents = 'auto'
    renderer.domElement.style.touchAction = 'none'
    renderer.domElement.style.userSelect = 'none'


    container.appendChild(renderer.domElement)

    // 创建控制器
    controls = new OrbitControls(camera, renderer.domElement)
    controls.enableDamping = true
    controls.dampingFactor = 0.05
    controls.enableZoom = true
    controls.enablePan = false
    controls.enableRotate = true

    // 设置旋转中心点
    controls.target.set(0, 0, 0)

    // 设置距离限制
    controls.maxDistance = 10
    controls.minDistance = 2

    // 设置垂直旋转角度范围（重要！）
    // controls.minPolarAngle = 0 // 允许从顶部看
    // controls.maxPolarAngle = Math.PI // 允许从底部看

    const fixedPolarAngle = Math.PI / 2 // 固定为水平角度（90°）

    controls.minPolarAngle = fixedPolarAngle
    controls.maxPolarAngle = fixedPolarAngle


    // 设置水平旋转范围（无限制）
    controls.minAzimuthAngle = -Infinity
    controls.maxAzimuthAngle = Infinity

    // 确保鼠标/触摸事件正确处理
    controls.mouseButtons = {
      LEFT: THREE.MOUSE.ROTATE,
      MIDDLE: THREE.MOUSE.DOLLY,
      RIGHT: THREE.MOUSE.PAN
    }

    // 触摸事件设置
    controls.touches = {
      ONE: THREE.TOUCH.ROTATE,
      TWO: THREE.TOUCH.DOLLY_PAN
    }

    // 添加光照
    setupLighting()

    // 加载模型
    await loadShoeModel()

    // 加载完成后，给 AB 区和 public 下的默认贴图先贴上
    applyInitialDefaultTextures()

    // 开始渲染循环
    animate()

    // 设置响应式
    setupResponsive()

    loading.value = false

    // 3秒后隐藏手势提示
    setTimeout(() => {
      showGestureHint.value = false
    }, 3000)

  } catch (err) {
    console.error('初始化Three.js失败:', err)
    error.value = '初始化失败，请刷新页面重试'
    loading.value = false
  }
}

// 设置光照
const setupLighting = () => {
  // 环境光 - 使用白光，避免色彩偏移
  ambientLight = new THREE.AmbientLight(0xffffff, lightingIntensity.value.ambient)
  scene.add(ambientLight)

  // 主光源 - 使用纯白光
  directionalLight = new THREE.DirectionalLight(0xffffff, lightingIntensity.value.directional)
  directionalLight.position.set(5, 5, 5)
  directionalLight.castShadow = true
  directionalLight.shadow.mapSize.width = 2048
  directionalLight.shadow.mapSize.height = 2048
  scene.add(directionalLight)

  // 补充光源 - 使用纯白光
  fillLight = new THREE.DirectionalLight(0xffffff, lightingIntensity.value.fill)
  fillLight.position.set(-5, 0, -5)
  scene.add(fillLight)

  // 添加顶部光源
  topLight = new THREE.DirectionalLight(0xffffff, lightingIntensity.value.additional)
  topLight.position.set(0, 10, 0)
  scene.add(topLight)

  // 添加底部光源
  bottomLight = new THREE.DirectionalLight(0xffffff, lightingIntensity.value.additional * 0.8)
  bottomLight.position.set(0, -10, 0)
  scene.add(bottomLight)

  // 添加左侧光源
  leftLight = new THREE.DirectionalLight(0xffffff, lightingIntensity.value.additional)
  leftLight.position.set(-10, 0, 0)
  scene.add(leftLight)

  // 添加右侧光源
  rightLight = new THREE.DirectionalLight(0xffffff, lightingIntensity.value.additional)
  rightLight.position.set(10, 0, 0)
  scene.add(rightLight)

  // 添加前方聚光灯
  spotLight = new THREE.SpotLight(0xffffff, lightingIntensity.value.directional * 0.8, 100, Math.PI / 6, 0.5)
  spotLight.position.set(0, 0, 15)
  spotLight.target.position.set(0, 0, 0)
  spotLight.castShadow = true
  scene.add(spotLight)
  scene.add(spotLight.target)
}

// 修改加载鞋子模型函数
const loadShoeModel = async () => {
  try {
    const { scene: clonedScene, animations } = await getClonedGLTF(withBase('xie.gltf'))
    shoeModel = clonedScene

    // 设置模型属性 - 放大3倍
    shoeModel.scale.set(11, 11, 11)
    shoeModel.position.set(0, 0, 0)

    // 遍历模型，设置材质和阴影
    let meshIndex = 0
    shoeModel.traverse((child) => {
      if (child instanceof THREE.Mesh) {
        // 保存原始材质到userData（克隆后取一个代表材质）
        if (child.material) {
          child.userData.originalMaterial = (Array.isArray(child.material)
            ? child.material[0]
            : child.material
          )?.clone?.()
        }

        child.castShadow = true
        child.receiveShadow = true

        // 确保材质没有额外的颜色偏移
        if (child.material) {
          if (Array.isArray(child.material)) {
            child.material.forEach((mat) => {
              if (mat instanceof THREE.MeshStandardMaterial) {
                mat.envMapIntensity = 0
              }
            })
          } else if (child.material instanceof THREE.MeshStandardMaterial) {
            child.material.envMapIntensity = 0
          }
          ; (child.material as any).needsUpdate = true
        }

        meshList.value.push({ name: child.name || `Mesh ${meshIndex}`, index: meshIndex, mesh: child })
        meshIndex++
      }
    })

    scene.add(shoeModel)

    // 如果有动画，设置动画混合器
    if (animations && animations.length > 0) {
      mixer = new THREE.AnimationMixer(shoeModel)
      animations.forEach((clip) => {
        const action = mixer.clipAction(clip)
        action.play()
      })
    }

    // 打印 Mesh 列表，方便定位名称
    logMeshNames(300)
  } catch (err) {
    console.error('模型加载失败:', err)
    throw err
  }
}

// 根据关键词集合匹配 Mesh（支持包含匹配和父级节点名匹配）并应用贴图
const applyTextureToMeshesByKeywords = (keywords: string[], texturePath: string) => {
  if (!shoeModel) return

  const tryApply = (texture: THREE.Texture) => {
    // 确保颜色空间正确
    // @ts-ignore - 兼容不同 three 版本
    texture.colorSpace = (THREE as any).SRGBColorSpace || (THREE as any).sRGBEncoding
    texture.wrapS = THREE.ClampToEdgeWrapping
    texture.wrapT = THREE.ClampToEdgeWrapping
    texture.repeat.set(1, 1)
    texture.offset.set(0, 0)
    texture.minFilter = THREE.LinearMipmapLinearFilter
    texture.magFilter = THREE.LinearFilter
    texture.flipY = false

    let appliedCount = 0
    const lowers = keywords.map(k => k.trim().toLowerCase()).filter(Boolean)

    shoeModel.traverse((child) => {
      if (child instanceof THREE.Mesh) {
        const meshName = (child.name || '').trim()
        const meshLower = meshName.toLowerCase()

        const parentNames: string[] = []
        let p: any = child.parent
        while (p && p !== shoeModel && parentNames.length < 4) {
          if (p.name) parentNames.push(String(p.name).toLowerCase())
          p = p.parent
        }

        const matched = lowers.some(k =>
          meshLower.includes(k) || parentNames.some(n => n.includes(k))
        )

        if (matched) {
          if (child.material instanceof THREE.MeshStandardMaterial) {
            const newMaterial = child.material.clone()
            newMaterial.map = texture
            newMaterial.needsUpdate = true
            child.material = newMaterial
            appliedCount++
          } else if (Array.isArray(child.material)) {
            child.material = child.material.map((mat) => {
              if (mat instanceof THREE.MeshStandardMaterial) {
                const newMat = mat.clone()
                newMat.map = texture
                newMat.needsUpdate = true
                return newMat
              }
              return mat
            })
            appliedCount++
          }
        }
      }
    })
    if (appliedCount === 0) {
      console.warn('[贴图未匹配] 未找到匹配的 Mesh：', keywords, ' 当前可用Mesh示例：', meshList.value.slice(0, 10))
    } else {
      console.info('[贴图已应用]', texturePath, ' 匹配关键词：', keywords, ' 数量：', appliedCount)
    }
    return appliedCount
  }

  const candidates: string[] = Array.from(new Set([
    texturePath,
    withBase(texturePath.replace(/^\//, '')),
    `/` + texturePath.replace(/^\//, ''),
    texturePath.replace(/^\//, ''),
    `./` + texturePath.replace(/^\//, ''),
    `${window.location.origin}${withBase(texturePath.replace(/^\//, ''))}`
  ]))

  loadTextureFromCandidates(candidates)
    .then((texture) => {
      const key = candidates[0]
      if (key) textureCache[key] = texture
      tryApply(texture)
    })
    .catch((err) => {
      console.error('[贴图加载失败-所有候选均失败]', texturePath, err)
    })
}

// 移除指定网格的材质
const removeMaterialFromMesh = (keywords: string[]) => {
  if (!shoeModel) return

  const lowers = keywords.map(k => k.trim().toLowerCase()).filter(Boolean)
  let removedCount = 0

  shoeModel.traverse((child) => {
    if (child instanceof THREE.Mesh) {
      const meshName = (child.name || '').trim()
      const meshLower = meshName.toLowerCase()

      const parentNames: string[] = []
      let p: any = child.parent
      while (p && p !== shoeModel && parentNames.length < 4) {
        if (p.name) parentNames.push(String(p.name).toLowerCase())
        p = p.parent
      }

      const matched = lowers.some(k =>
        meshLower.includes(k) || parentNames.some(n => n.includes(k))
      )

      if (matched) {
        child.material = new THREE.MeshBasicMaterial({ visible: false })
        removedCount++
      }
    }
  })

  if (removedCount > 0) {
    console.info('[材质已移除]', keywords, '数量：', removedCount)
  } else {
    console.warn('[材质移除失败] 未找到匹配的 Mesh：', keywords)
  }
}

// 应用默认贴图：AB + public 根目录的 xiedai/xiedi/xiedian
const applyInitialDefaultTextures = () => {
  // A/B 默认
  applyTextureToMeshA(getTexturePath('A', selectedATexture.value))
  applyTextureToMeshB(getTexturePath('B', selectedBTexture.value))

  // public 根目录（Vite 会以站点根路径提供）
  const publicDefaults: Array<{ keywords: string[]; path: string }> = [
    {
      path: withBase('tietu/xiedai.png'),
      keywords: ['xiedai']
    },
    {
      path: withBase('tietu/xiedi.png'),
      keywords: ['xiedi', 'logoai']
    },
    {
      path: withBase('tietu/xian.png'),
      keywords: ['xian']
    },
    {
      path: withBase('tietu/xian2.png'),
      keywords: ['xian2']
    },
    {
      path: withBase('tietu/xiedian.png'),
      keywords: ['xiedian']
    }
  ]

  publicDefaults.forEach(({ keywords, path }) => applyTextureToMeshesByKeywords(keywords, path))

  // 兜底：对已知精确名称再匹配一次（避免关键词不命中）
  const applyExact = (meshName: string, path: string) => applyTextureToMeshesByKeywords([meshName], path)
  applyExact('xiedai', withBase('tietu/xiedai.png'))
  applyExact('xian', withBase('tietu/xian.png'))     // xian 用专属的 xian.png 贴图
  applyExact('xiedian', withBase('tietu/xiedian.png'))

  // 兜底2：如果仍未命中，尝试按常见索引（基于你提供的清单顺序，安全起见仅当索引存在时）
  const byIndex = (idx: number, path: string) => {
    const item = meshList.value.find(m => m.index === idx)
    if (item) {
      applyTextureToMeshesByKeywords([item.name], path)
    }
  }
  byIndex(2, withBase('tietu/xiedai.png'))  // index 2: xiedai
  byIndex(3, withBase('tietu/xian.png'))    // index 3: xian 用专属的 xian.png 贴图
  byIndex(7, withBase('tietu/xiedian.png')) // index 7: xiedian


}

// 渲染循环
const animate = () => {
  animationId = requestAnimationFrame(animate)

  // 更新控制器
  controls.update()

  // 更新动画
  if (mixer && isAnimating.value) {
    mixer.update(0.016)
  }

  // 自动旋转
  if (shoeModel && isAnimating.value) {
    shoeModel.rotation.y += 0.005
  }

  // 渲染
  renderer.render(scene, camera)
}


// 改变环境
const changeEnvironment = () => {
  const environments: { [key: string]: number } = {
    studio: 0xf0f0f0,
    outdoor: 0x87CEEB,
    dark: 0x222222
  }

  scene.background = new THREE.Color(environments[selectedEnvironment.value])
}

// 切换动画
const toggleAnimation = () => {
  isAnimating.value = !isAnimating.value
}

// 重置视角
const resetView = () => {
  cameraPosition.value = { x: 0, y: 0, z: 5 }
  updateCameraPosition()
  controls.reset()
  if (shoeModel) {
    shoeModel.rotation.set(0, 0, 0)
  }

  // 重置灯光强度
  lightingIntensity.value = {
    ambient: 3.0,
    directional: 3.0,
    fill: 2.0,
    additional: 1.5
  }
  updateLightingIntensity()
}

// 截图
const takeScreenshot = () => {
  const canvas = renderer.domElement
  const link = document.createElement('a')
  link.download = 'shoe-screenshot.png'
  link.href = canvas.toDataURL()
  link.click()
}

// 全屏
const toggleFullscreen = () => {
  if (!document.fullscreenElement) {
    containerRef.value?.requestFullscreen()
  } else {
    document.exitFullscreen()
  }
}

// 重试加载
const retryLoad = () => {
  error.value = ''
  loading.value = true
  loadingProgress.value = 0
  initThree()
}

// 响应式设置
const setupResponsive = () => {
  const handleResize = () => {
    if (!containerRef.value) return

    const container = containerRef.value
    camera.aspect = container.clientWidth / container.clientHeight
    camera.updateProjectionMatrix()
    renderer.setSize(container.clientWidth, container.clientHeight)
  }

  window.addEventListener('resize', handleResize)

  // 监听容器大小变化
  const resizeObserver = new ResizeObserver(handleResize)
  resizeObserver.observe(containerRef.value!)

  // 监听屏幕方向变化
  window.addEventListener('orientationchange', () => {
    setTimeout(handleResize, 100) // 延迟处理，确保新尺寸生效
  })
}



// 颜色映射表
const colorMapping: Record<string, { name: string, color: string }> = {
  // A区域颜色
  'A1.png': { name: '雀茶', color: '#8B572A' },
  'A2.png': { name: '樱落', color: '#BA6A74' },
  'A3.png': { name: '衰柳', color: '#C4D69B' },
  'A4.png': { name: '盈盈', color: '#D9A1B3' },
  'A5.png': { name: '唐茶', color: '#A57A68' },
  'A6.png': { name: '古檀', color: '#2B1B12' },

  // B区域颜色
  'B2.png': { name: '金豹', color: '#C49D4D' },
  'B1.png': { name: '凝露', color: '#5C0A1D' },
  'B3.png': { name: '木檀', color: '#9B738F' },
  'B4.png': { name: '柳染', color: '#B4B24B' },
  'B5.png': { name: '胡杏', color: '#FFF1E5' },
  'B6.png': { name: '常春', color: '#C98E85' }
}

// 获取颜色名称
const getColorName = (folder: 'A' | 'B', textureName: string) => {
  const mapping = colorMapping[textureName]
  return mapping ? mapping.name : textureName.replace('.png', '')
}





// 获取颜色
const getColorForTexture = (folder: 'A' | 'B', textureName: string) => {
  const mapping = colorMapping[textureName]
  return mapping ? mapping.color : '#CCCCCC'
}

// 颜色选择器缩略图样式（支持图片预览）
const getSwatchStyle = (folder: 'A' | 'B', textureName: string) => {
  if (folder === 'B' && textureName === 'B2.png') {
    const url = getTexturePath('B', 'B2.png')
    return {
      backgroundImage: `url(${url})`,
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      backgroundRepeat: 'no-repeat'
    } as Record<string, string>
  }
  return { backgroundColor: getColorForTexture(folder, textureName) } as Record<string, string>
}

// 定制完成
const completeCustomization = () => {
  alert('定制完成！')
  // 可以选择保存当前的鞋子模型或贴图设置
  // 例如，将当前的贴图应用到实际的鞋子模型
  // 或者将当前的贴图保存为新的模型
  console.log('当前选中的A贴图:', selectedATexture.value)
  console.log('当前选中的B贴图:', selectedBTexture.value)
  console.log('当前相机位置:', cameraPosition.value)
  console.log('当前灯光强度:', lightingIntensity.value)
  console.log('当前动画状态:', isAnimating.value)

}

const onConfirm = () => {
  showConfirm.value = false
  completeCustomization()
}





// 生命周期
onMounted(async () => {
  await nextTick()
  initThree()

    // 将Mesh操作函数添加到全局，方便控制台调用
    ; (window as any).getMeshByIndex = getMeshByIndex
    ; (window as any).getMeshByName = getMeshByName
    ; (window as any).meshList = meshList
    ; (window as any).switchToATexture = switchToATexture
    ; (window as any).switchToBTexture = switchToBTexture
    ; (window as any).getColorName = getColorName
    ; (window as any).getColorForTexture = getColorForTexture
    ; (window as any).completeCustomization = completeCustomization
    ; (window as any).dumpMeshNames = (limit?: number) => logMeshNames(limit)

})

onUnmounted(() => {
  if (animationId) {
    cancelAnimationFrame(animationId)
  }
  if (renderer) {
    renderer.dispose()
  }
  if (controls) {
    controls.dispose()
  }

})
</script>

<style>
/* 控制面板滚动条样式 */
.control-panel::-webkit-scrollbar {
  width: 6px;
}

.control-panel::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.control-panel::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
  transition: background 0.2s;
}

.control-panel::-webkit-scrollbar-thumb:hover {
  background: #a1a1a1;
}

/* 滑块样式 */
.slider::-webkit-slider-thumb {
  appearance: none;
  height: 16px;
  width: 16px;
  border-radius: 50%;
  background: #3498db;
  cursor: pointer;
  box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
}

.slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: #3498db;
  cursor: pointer;
  border: none;
  box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
}

.slider::-webkit-slider-track {
  width: 100%;
  height: 8px;
  cursor: pointer;
  background: #ddd;
  border-radius: 4px;
}

.slider::-moz-range-track {
  width: 100%;
  height: 8px;
  cursor: pointer;
  background: #ddd;
  border-radius: 4px;
  border: none;
}

/* 移动端适配 */
@media (max-width: 768px) {

  /* 确保3D视窗在移动端有合适的高度 */
  .relative>div[ref="containerRef"] {
    height: calc(100vh - 300px) !important;
    min-height: 300px !important;
  }

  /* 底部面板在移动端的样式调整 */
  .absolute.bottom-0 {
    max-height: 60vh !important;
    overflow-y: auto !important;
  }

  /* 颜色选择器在移动端稍小一些 */
  .w-12.h-12 {
    width: 2.5rem !important;
    height: 2.5rem !important;
  }

  /* 调整颜色选择器间距 */
  .space-x-4>*+* {
    margin-left: 0.75rem !important;
  }

  /* 调整按钮高度 */
  .py-4 {
    padding-top: 0.75rem !important;
    padding-bottom: 0.75rem !important;
  }
}

/* 小屏幕适配 */
@media (max-width: 480px) {

  /* 进一步减小3D视窗高度 */
  .relative>div[ref="containerRef"] {
    height: calc(100vh - 350px) !important;
    min-height: 250px !important;
  }

  /* 颜色选择器更小 */
  .w-12.h-12 {
    width: 2rem !important;
    height: 2rem !important;
  }

  /* 减小间距 */
  .space-x-4>*+* {
    margin-left: 0.5rem !important;
  }

  .space-y-6>*+* {
    margin-top: 1rem !important;
  }

  /* 调整内边距 */
  .p-6 {
    padding: 1rem !important;
  }

  /* 调整字体大小 */
  .text-lg {
    font-size: 1rem !important;
  }

  /* 调整按钮文字大小 */
  .text-lg.font-semibold {
    font-size: 1rem !important;
  }
}

/* 横屏适配 */
@media (orientation: landscape) and (max-height: 600px) {
  .relative>div[ref="containerRef"] {
    height: 50vh !important;
    min-height: 200px !important;
  }

  .absolute.bottom-0 {
    max-height: 45vh !important;
  }
}

/* 触摸设备优化 */
@media (hover: none) and (pointer: coarse) {

  /* 触摸设备上的按钮反馈 */
  .cursor-pointer:active {
    transform: scale(0.95) !important;
    transition: transform 0.1s !important;
  }

  /* 颜色选择器的触摸反馈 */
  .w-12.h-12:active {
    transform: scale(0.9) !important;
  }

  /* 移除hover效果 */
  .hover\:border-gray-400:hover {
    border-color: inherit !important;
  }

  .hover\:from-orange-500:hover {
    background-image: inherit !important;
  }
}

/* 确保滚动条样式 */
.overflow-y-auto::-webkit-scrollbar {
  width: 4px;
}

.overflow-y-auto::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 2px;
}

.overflow-y-auto::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 2px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background: #a1a1a1;
}

/* 确保白色颜色有边框可见性 */
.w-12.h-12[style*="background-color: rgb(255, 255, 255)"],
.w-12.h-12[style*="background-color: #FFFFFF"],
.w-12.h-12[style*="background-color: #FDF5E6"] {
  border: 4px solid #e5e5e5 !important;
}

/* 无障碍适配 */
@media (prefers-reduced-motion: reduce) {
  .animate-spin {
    animation: none !important;
  }

  .transition-all {
    transition: none !important;
  }

  .transform {
    transform: none !important;
  }
}

/* 高对比度模式支持 */
@media (prefers-contrast: high) {
  .bg-gradient-to-b {
    background: #f5f5f5 !important;
  }

  .text-gray-600 {
    color: #000000 !important;
  }

  .border-gray-300 {
    border-color: #000000 !important;
  }
}
</style>